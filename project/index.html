<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-fences-math .MathJax_SVG_Display, .md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: visible; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; zoom: 90%; }
#math-inline-preview-content { zoom: 1.1; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-math .MathJax_SVG_Display { margin-top: 8px; cursor: default; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
  --mermaid-theme: night;
}

[lang='mermaid'] .label {
  color: #333;
}

/* CSS Document */

/** code highlight */

.cm-s-inner .cm-variable,
.cm-s-inner .cm-operator,
.cm-s-inner .cm-property {
    color: #b8bfc6;
}

.cm-s-inner .cm-keyword {
    color: #C88FD0;
}

.cm-s-inner .cm-tag {
    color: #7DF46A;
}

.cm-s-inner .cm-attribute {
    color: #7575E4;
}

.CodeMirror div.CodeMirror-cursor {
    border-left: 1px solid #b8bfc6;
    z-index: 3;
}

.cm-s-inner .cm-string {
    color: #D26B6B;
}

.cm-s-inner .cm-comment,
.cm-s-inner.cm-comment {
    color: #DA924A;
}

.cm-s-inner .cm-header,
.cm-s-inner .cm-def,
.cm-s-inner.cm-header,
.cm-s-inner.cm-def {
    color: #8d8df0;
}

.cm-s-inner .cm-quote,
.cm-s-inner.cm-quote {
    color: #57ac57;
}

.cm-s-inner .cm-hr {
    color: #d8d5d5;
}

.cm-s-inner .cm-link {
    color: #d3d3ef;
}

.cm-s-inner .cm-negative {
    color: #d95050;
}

.cm-s-inner .cm-positive {
    color: #50e650;
}

.cm-s-inner .cm-string-2 {
    color: #f50;
}

.cm-s-inner .cm-meta,
.cm-s-inner .cm-qualifier {
    color: #b7b3b3;
}

.cm-s-inner .cm-builtin {
    color: #f3b3f8;
}

.cm-s-inner .cm-bracket {
    color: #997;
}

.cm-s-inner .cm-atom,
.cm-s-inner.cm-atom {
    color: #84B6CB;
}

.cm-s-inner .cm-number {
    color: #64AB8F;
}

.cm-s-inner .cm-variable {
    color: #b8bfc6;
}

.cm-s-inner .cm-variable-2 {
    color: #9FBAD5;
}

.cm-s-inner .cm-variable-3 {
    color: #1cc685;
}

.CodeMirror-selectedtext,
.CodeMirror-selected {
    background: #4a89dc;
    color: #fff !important;
    text-shadow: none;
}

.CodeMirror-gutters {
    border-right: none;
}

/* CSS Document */

/** markdown source **/
.cm-s-typora-default .cm-header, 
.cm-s-typora-default .cm-property
{
    color: #cebcca;
}

.CodeMirror.cm-s-typora-default div.CodeMirror-cursor{
    border-left: 3px solid #b8bfc6;
}

.cm-s-typora-default .cm-comment {
    color: #9FB1FF;
}

.cm-s-typora-default .cm-string {
    color: #A7A7D9
}

.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number {
    color: #848695;
    font-style: italic;
}

.cm-s-typora-default .cm-link {
    color: #95B94B;
}

.cm-s-typora-default .CodeMirror-activeline-background {
    background: rgba(51, 51, 51, 0.72);
}

.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code {
	color: #8aa1e1;
}@import "";
@import "";
@import "";

:root {
    --bg-color:  #363B40;
    --side-bar-bg-color: #2E3033;
    --text-color: #b8bfc6;

    --select-text-bg-color:#4a89dc;

    --item-hover-bg-color: #0a0d16;
    --control-text-color: #b7b7b7;
    --control-text-hover-color: #eee;
    --window-border: 1px solid #555;

    --active-file-bg-color: rgb(34, 34, 34);
    --active-file-border-color: #8d8df0;

    --primary-color: #a3d5fe;

    --active-file-text-color: white;
    --item-hover-bg-color: #70717d;
    --item-hover-text-color: white;
    --primary-color: #6dc1e7;

    --rawblock-edit-panel-bd: #333;

    --search-select-bg-color: #428bca;
}

html {
    font-size: 16px;
}

html,
body {
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    background: #363B40;
    background: var(--bg-color);
    fill: currentColor;
    line-height: 1.625rem;
}

#write {
    max-width: 914px;
}


@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

html,
body,
button,
input,
select,
textarea,
div.code-tooltip-content {
    color: #b8bfc6;
    border-color: transparent;
}

div.code-tooltip,
.md-hover-tip .md-arrow:after {
    background: #333;
}

.popover.bottom > .arrow:after {
    border-bottom-color: #333;
}

html,
body,
button,
input,
select,
textarea {
    font-family: "Times New Roman", 標楷體, "Helvetica Neue", Helvetica, Arial, sans-serif;
}

hr {
    height: 2px;
    border: 0;
    margin: 24px 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: "Times New Roman", 標楷體, "Lucida Grande", "Corbel", sans-serif;
    font-weight: normal;
    clear: both;
    -ms-word-wrap: break-word;
    word-wrap: break-word;
    margin: 0;
    padding: 0;
    color: #DEDEDE
}

h1 {
    font-size: 2.5rem;
    /* 36px */
    line-height: 2.75rem;
    /* 40px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1.5px;
}

h2 {
    font-size: 1.63rem;
    /* 24px */
    line-height: 1.875rem;
    /* 30px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h3 {
    font-size: 1.17rem;
    /* 18px */
    line-height: 1.5rem;
    /* 24px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h4 {
    font-size: 1.12rem;
    /* 16px */
    line-height: 1.375rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    color: white;
}

h5 {
    font-size: 0.97rem;
    /* 16px */
    line-height: 1.25rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    font-weight: bold;
}

h6 {
    font-size: 0.93rem;
    /* 16px */
    line-height: 1rem;
    /* 16px */
    margin-bottom: 0.75rem;
    color: white;
}

@media (min-width: 980px) {
    h3.md-focus:before,
    h4.md-focus:before,
    h5.md-focus:before,
    h6.md-focus:before {
        color: #ddd;
        border: 1px solid #ddd;
        border-radius: 3px;
        position: absolute;
        left: -1.642857143rem;
        top: .357142857rem;
        float: left;
        font-size: 9px;
        padding-left: 2px;
        padding-right: 2px;
        vertical-align: bottom;
        font-weight: normal;
        line-height: normal;
    }

    h3.md-focus:before {
        content: 'h3';
    }

    h4.md-focus:before {
        content: 'h4';
    }

    h5.md-focus:before {
        content: 'h5';
        top: 0px;
    }

    h6.md-focus:before {
        content: 'h6';
        top: 0px;
    }
}

a {
    text-decoration: none;
    outline: 0;
}

a:hover {
    outline: 0;
}

a:focus {
    outline: thin dotted;
}

sup.md-footnote {
    background-color: #555;
    color: #ddd;
}

p {
    -ms-word-wrap: break-word;
    word-wrap: break-word;
}

p,
ul,
dd,
ol,
hr,
address,
pre,
table,
iframe,
.wp-caption,
.wp-audio-shortcode,
.wp-video-shortcode {
    margin-top: 0;
    margin-bottom: 1.5rem;
    /* 24px */
}

audio:not([controls]) {
    display: none;
}

[hidden] {
    display: none;
}

::-moz-selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

*.in-text-selection,
::selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

ul,
ol {
    padding: 0 0 0 1.875rem;
    /* 30px */
}

ul {
    list-style: square;
}

ol {
    list-style: decimal;
}

ul ul,
ol ol,
ul ol,
ol ul {
    margin: 0;
}

b,
th,
dt,
strong {
    font-weight: bold;
}

i,
em,
dfn,
cite {
    font-style: italic;
}

blockquote {
    padding-left: 1.875rem;
    margin: 0 0 1.875rem 1.875rem;
    border-left: solid 2px #474d54;
    padding-left: 30px;
    margin-top: 35px;
}

pre,
code,
kbd,
tt,
var {
    font-size: 0.875em;
    font-family: Monaco, Consolas, "Andale Mono", "DejaVu Sans Mono", monospace;
}

code,
tt,
var {
    background: rgba(0, 0, 0, 0.05);
}

kbd {
    padding: 2px 4px;
    font-size: 90%;
    color: #fff;
    background-color: #333;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.25);
}

pre.md-fences {
    padding: 10px 10px 10px 30px;
    margin-bottom: 20px;
    background: #333;
}

.CodeMirror-gutters {
    background: #333;
    border-right: 1px solid transparent;
}

.enable-diagrams pre.md-fences[lang="sequence"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="flow"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="mermaid"] .code-tooltip {
    bottom: -2.2em;
    right: 4px;
}

code,
kbd,
tt,
var {
    padding: 2px 5px;
}

table {
    max-width: 100%;
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
}

th,
td {
    padding: 5px 10px;
    vertical-align: top;
}

a {
    -webkit-transition: all .2s ease-in-out;
    transition: all .2s ease-in-out;
}

hr {
    background: #474d54;
    /* variable */
}

h1 {
    margin-top: 2em;
}

a {
    color: #e0e0e0;
    text-decoration: underline;
}

a:hover {
    color: #fff;
}

.md-inline-math script {
    color: #81b1db;
}

b,
th,
dt,
strong {
    color: #DEDEDE;
    /* variable */
}

mark {
    background: #D3D40E;
}

blockquote {
    color: #9DA2A6;
}

table a {
    color: #DEDEDE;
    /* variable */
}

th,
td {
    border: solid 1px #474d54;
    /* variable */
}

.task-list {
    padding-left: 0;
}

.md-task-list-item {
    padding-left: 1.25rem;
}

.md-task-list-item > input {
    top: auto;
}

.md-task-list-item > input:before {
    content: "";
    display: inline-block;
    width: 0.875rem;
    height: 0.875rem;
    vertical-align: middle;
    text-align: center;
    border: 1px solid #b8bfc6;
    background-color: #363B40;
    margin-top: -0.4rem;
}

.md-task-list-item > input:checked:before,
.md-task-list-item > input[checked]:before {
    content: '\221A';
    /*◘*/
    font-size: 0.625rem;
    line-height: 0.625rem;
    color: #DEDEDE;
}

/** quick open **/
.auto-suggest-container {
    border: 0px;
    background-color: #525C65;
}

#typora-quick-open {
    background-color: #525C65;
}

#typora-quick-open input{
    background-color: #525C65;
    border: 0;
    border-bottom: 1px solid grey;
}

.typora-quick-open-item {
    background-color: inherit;
    color: inherit;
}

.typora-quick-open-item.active,
.typora-quick-open-item:hover {
    background-color: #4D8BDB;
    color: white;
}

.typora-quick-open-item:hover {
    background-color: rgba(77, 139, 219, 0.8);
}

.typora-search-spinner > div {
  background-color: #fff;
}

#write pre.md-meta-block {
    border-bottom: 1px dashed #ccc;
    background: transparent;
    padding-bottom: 0.6em;
    line-height: 1.6em;
}

.btn,
.btn .btn-default {
    background: transparent;
    color: #b8bfc6;
}

.ty-table-edit {
    border-top: 1px solid gray;
    background-color: #363B40;
}

.popover-title {
    background: transparent;
}

.md-image>.md-meta {
    color: #BBBBBB;
    background: transparent;
}

.md-expand.md-image>.md-meta {
    color: #DDD;
}

#write>h3:before,
#write>h4:before,
#write>h5:before,
#write>h6:before {
    border: none;
    border-radius: 0px;
    color: #888;
    text-decoration: underline;
    left: -1.4rem;
    top: 0.2rem;
}

#write>h3.md-focus:before {
    top: 2px;
}

#write>h4.md-focus:before {
    top: 2px;
}

.md-toc-item {
    color: #A8C2DC;
}

#write div.md-toc-tooltip {
    background-color: #363B40;
}

.dropdown-menu .btn:hover,
.dropdown-menu .btn:focus,
.md-toc .btn:hover,
.md-toc .btn:focus {
    color: white;
    background: black;
}

#toc-dropmenu {
    background: rgba(50, 54, 59, 0.93);
    border: 1px solid rgba(253, 253, 253, 0.15);
}

#toc-dropmenu .divider {
    background-color: #9b9b9b;
}

.outline-expander:before {
    top: 2px;
}

#typora-sidebar {
    box-shadow: none;
    border-right: 1px dashed;
    border-right: none;
}

.sidebar-tabs {
    border-bottom:0;
}

#typora-sidebar:hover .outline-title-wrapper {
    border-left: 1px dashed;
}

.outline-title-wrapper .btn {
    color: inherit;
}

.outline-item:hover {
    border-color: #363B40;
    background-color: #363B40;
    color: white;
}

h1.md-focus .md-attr,
h2.md-focus .md-attr,
h3.md-focus .md-attr,
h4.md-focus .md-attr,
h5.md-focus .md-attr,
h6.md-focus .md-attr,
.md-header-span .md-attr {
    color: #8C8E92;
    display: inline;
}

.md-comment {
    color: #5a95e3;
    opacity: 1;
}

.md-inline-math svg {
    color: #b8bfc6;
}

#math-inline-preview .md-arrow:after {
    background: black;
}

.modal-content {
    background: var(--bg-color);
    border: 0;
}

.modal-title {
    font-size: 1.5em;
}

.modal-content input {
    background-color: rgba(26, 21, 21, 0.51);
    color: white;
}

.modal-content .input-group-addon {
    color: white;
}

.modal-backdrop {
    background-color: rgba(174, 174, 174, 0.7);
}

.modal-content .btn-primary {
    border-color: var(--primary-color);
}

.md-table-resize-popover {
    background-color: #333;
}

.form-inline .input-group .input-group-addon {
    color: white;
}

#md-searchpanel {
    border-bottom: 1px dashed grey;
}

/** UI for electron */

.context-menu,
#spell-check-panel,
#footer-word-count-info {
    background-color: #42464A;
}

.context-menu.dropdown-menu .divider,
.dropdown-menu .divider {
    background-color: #777777;
    opacity: 1;
}

footer {
    color: inherit;
}

@media (max-width: 1000px) {
    footer {
        border-top: none;
    }
    footer:hover {
        color: inherit;
    }
}

#file-info-file-path .file-info-field-value:hover {
    background-color: #555;
    color: #dedede;
}

.megamenu-content,
.megamenu-opened header {
    background: var(--bg-color);
}

.megamenu-menu-panel h2,
.megamenu-menu-panel h1,
.long-btn {
    color: inherit;
}

.megamenu-menu-panel input[type='text'] {
    background: inherit;
    border: 0;
    border-bottom: 1px solid;
}

#recent-file-panel-action-btn {
    background: inherit;
    border: 1px grey solid;
}

.megamenu-menu-panel .dropdown-menu > li > a {
    color: inherit;
    background-color: #2F353A;
    text-decoration: none;
}

.megamenu-menu-panel table td:nth-child(1) {
    color: inherit;
    font-weight: bold;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(1) {
    color: white;
}

.modal-footer .btn-default, 
.modal-footer .btn-primary,
.modal-footer .btn-default:not(:hover) {
    border: 1px solid;
    border-color: transparent;
}

.btn-primary {
    color: white;
}

.btn-default:hover, .btn-default:focus, .btn-default.focus, .btn-default:active, .btn-default.active, .open > .dropdown-toggle.btn-default {
    color: white;
    border: 1px solid #ddd;
    background-color: inherit;
}

.modal-header {
    border-bottom: 0;
}

.modal-footer {
    border-top: 0;
}

#recent-file-panel tbody tr:nth-child(2n-1) {
    background-color: transparent !important;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(2) {
    color: inherit;
}

.megamenu-menu-panel .btn {
    border: 1px solid #eee;
    background: transparent;
}

.mouse-hover .toolbar-icon.btn:hover,
#w-full.mouse-hover,
#w-pin.mouse-hover {
    background-color: inherit;
}

.typora-node::-webkit-scrollbar {
    width: 5px;
}

.typora-node::-webkit-scrollbar-thumb:vertical {
    background: rgba(250, 250, 250, 0.3);
}

.typora-node::-webkit-scrollbar-thumb:vertical:active {
    background: rgba(250, 250, 250, 0.5);
}

#w-unpin {
    background-color: #4182c4;
}

#top-titlebar, #top-titlebar * {
    color: var(--item-hover-text-color);
}

.typora-sourceview-on #toggle-sourceview-btn,
#footer-word-count:hover,
.ty-show-word-count #footer-word-count {
    background: #333333;
}

#toggle-sourceview-btn:hover {
    color: #eee;
    background: #333333;
}

/** focus mode */
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) * {
    color: #686868 !important;
}

.on-focus-mode .md-end-block:not(.md-focus) img,
.on-focus-mode .md-task-list-item:not(.md-focus-container)>input {
    opacity: #686868 !important;
}

.on-focus-mode li[cid]:not(.md-focus-container){
    color: #686868;
}

.on-focus-mode .md-fences.md-focus .CodeMirror-code>*:not(.CodeMirror-activeline) *,
.on-focus-mode .CodeMirror.cm-s-inner:not(.CodeMirror-focused) * {
    color: #686868 !important;
}

.on-focus-mode .md-focus,
.on-focus-mode .md-focus-container {
    color: #fff;
}

.on-focus-mode #typora-source .CodeMirror-code>*:not(.CodeMirror-activeline) * {
    color: #686868 !important;
}


/*diagrams*/
#write .md-focus .md-diagram-panel {
    border: 1px solid #ddd;
    margin-left: -1px;
    width: calc(100% + 2px);
}

/*diagrams*/
#write .md-focus.md-fences-with-lineno .md-diagram-panel {
    margin-left: auto;
}

.md-diagram-panel-error {
    color: #f1908e;
}

.active-tab-files #info-panel-tab-file,
.active-tab-files #info-panel-tab-file:hover,
.active-tab-outline #info-panel-tab-outline,
.active-tab-outline #info-panel-tab-outline:hover {
    color: #eee;
}

.sidebar-footer-item:hover,
.footer-item:hover {
    background: inherit;
    color: white;
}

.ty-side-sort-btn.active,
.ty-side-sort-btn:hover,
.selected-folder-menu-item a:after {
    color: white;
}

#sidebar-files-menu {
    border:solid 1px;
    box-shadow: 4px 4px 20px rgba(0, 0, 0, 0.79);
    background-color: var(--bg-color);
}

.file-list-item {
    border-bottom:none;
}

.file-list-item-summary {
    opacity: 1;
}

.file-list-item.active:first-child {
    border-top: none;
}

.file-node-background {
    height: 32px;
}

.file-library-node.active>.file-node-content,
.file-list-item.active {
    color: white;
    color: var(--active-file-text-color);
}

.file-library-node.active>.file-node-background{
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}
.file-list-item.active {
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}

#ty-tooltip {
    background-color: black;
    color: #eee;
}

.md-task-list-item>input {
    margin-left: -1.3em;
    margin-top: 0.3rem;
    -webkit-appearance: none;
}

.md-mathjax-midline {
    background-color: #57616b;
    border-bottom: none;
}

footer.ty-footer {
    border-color: #656565;
}

.ty-preferences .btn-default {
    background: transparent;
}
.ty-preferences .btn-default:hover {
    background: #57616b;
}

.ty-preferences select {
    border: 1px solid #989698;
    height: 21px;
}

.ty-preferences .nav-group-item.active {
    background: var(--item-hover-bg-color);
}

.ty-preferences input[type="search"] {
    border-color: #333;
    background: #333;
    line-height: 22px;
    border-radius: 6px;
    color: white;
}

.ty-preferences input[type="search"]:focus {
    box-shadow: none;
}

[data-is-directory="true"] .file-node-content {
    margin-bottom: 0;
}

.file-node-title {
    line-height: 22px;
}

.html-for-mac .file-node-open-state, .html-for-mac .file-node-icon {
    line-height: 26px;
}

::-webkit-scrollbar-thumb {
    background: rgba(230, 230, 230, 0.30);
}

::-webkit-scrollbar-thumb:active {
    background: rgba(230, 230, 230, 0.50);
}

#typora-sidebar:hover div.sidebar-content-content::-webkit-scrollbar-thumb:horizontal {
    background: rgba(230, 230, 230, 0.30);
}

.nav-group-item:active {
    background-color: #474d54 !important;
}

.md-search-hit {
    background: rgba(199, 140, 60, 0.81);
    color: #eee;
}

.md-search-hit * {
    color: #eee;
}

#md-searchpanel input {
    color: white;
}

.modal-backdrop.in {
    opacity: 1;
    backdrop-filter: blur(1px);
}

 :root {--mermaid-font-zoom:1.25em ;} 
</style><title>Sprite Project Documentation, 0.9.3</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><br><br><br><center><h1><strong>一個 RISC-V 指令集的可視化仿真器與開發工具鏈<br>A RISC-V Emulator and Development Toolchain</strong></h1></center><p>&nbsp;</p><center><h2>程式實作前分析</h2></center><p style="text-align:right;">版本 0.9.3<br>© 2021 Sprite Development Team</p><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='目錄a-name目錄a'><span>目錄</span><a name="目錄"></a></h1><hr /><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n7"><a class="md-toc-inner" href="#目錄a-name目錄a">目錄</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n11"><a class="md-toc-inner" href="#摘要">摘要</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n16"><a class="md-toc-inner" href="#chapter-1名詞定義">Chapter 1　名詞定義</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20"><a class="md-toc-inner" href="#11語言類">1.1　語言類</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n21"><a class="md-toc-inner" href="#111sprite-c">1.1.1　Sprite C</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n23"><a class="md-toc-inner" href="#112sprite-intermediate-language">1.1.2　Sprite Intermediate Language</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n25"><a class="md-toc-inner" href="#113rv32i">1.1.3　RV32I</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n28"><a class="md-toc-inner" href="#12格式類">1.2　格式類</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n29"><a class="md-toc-inner" href="#121sprite-object-file">1.2.1　Sprite Object File</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n31"><a class="md-toc-inner" href="#122sprite-executable-file">1.2.2　Sprite Executable File</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n34"><a class="md-toc-inner" href="#13程式類">1.3　程式類</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n35"><a class="md-toc-inner" href="#131編譯器">1.3.1　編譯器</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n37"><a class="md-toc-inner" href="#132組譯器">1.3.2　組譯器</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n39"><a class="md-toc-inner" href="#133連結器">1.3.3　連結器</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n41"><a class="md-toc-inner" href="#134仿真器">1.3.4　仿真器</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n44"><a class="md-toc-inner" href="#chapter-2流程－以-testsc-為例">Chapter 2　流程－以 test.sc 為例</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n48"><a class="md-toc-inner" href="#21使用者視角">2.1　使用者視角</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n88"><a class="md-toc-inner" href="#22編譯器視角">2.2　編譯器視角</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n132"><a class="md-toc-inner" href="#23組譯器視角">2.3　組譯器視角</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n166"><a class="md-toc-inner" href="#24連結器視角">2.4　連結器視角</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n200"><a class="md-toc-inner" href="#25仿真器視角">2.5　仿真器視角</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n229"><a class="md-toc-inner" href="#chapter-3sprite-c">Chapter 3　Sprite C</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n233"><a class="md-toc-inner" href="#引言-1">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n234"><a class="md-toc-inner" href="#31資料型態">3.1　資料型態</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n235"><a class="md-toc-inner" href="#32關鍵字">3.2　關鍵字</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n236"><a class="md-toc-inner" href="#33運算子">3.3　運算子</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n237"><a class="md-toc-inner" href="#34詞法標記">3.4　詞法標記</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n238"><a class="md-toc-inner" href="#35文法">3.5　文法</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n239"><a class="md-toc-inner" href="#36未來規劃">3.6　未來規劃</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n240"><a class="md-toc-inner" href="#參考資料-1">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n242"><a class="md-toc-inner" href="#chapter-4sprite-intermediate-language">Chapter 4　Sprite Intermediate Language</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n246"><a class="md-toc-inner" href="#引言-2">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n249"><a class="md-toc-inner" href="#41語法">4.1　語法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n250"><a class="md-toc-inner" href="#411標籤與註解">4.1.1　標籤與註解</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n255"><a class="md-toc-inner" href="#412基礎指令">4.1.2　基礎指令</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n256"><a class="md-toc-inner" href="#4121immimmediate）">4.1.2.1　IMM（IMMediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n262"><a class="md-toc-inner" href="#4122movmove）">4.1.2.2　MOV（MOVe）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n268"><a class="md-toc-inner" href="#4123nopno-operation）">4.1.2.3　NOP（No OPeration）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n275"><a class="md-toc-inner" href="#413算術運算指令">4.1.3　算術運算指令</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n276"><a class="md-toc-inner" href="#4131add-add）">4.1.3.1　ADD （ADD）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n282"><a class="md-toc-inner" href="#4132subsubstract）">4.1.3.2　SUB（SUBstract）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n288"><a class="md-toc-inner" href="#4133mulmultiply）">4.1.3.3　MUL（MULtiply）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n294"><a class="md-toc-inner" href="#4134divdivide）">4.1.3.4　DIV（DIVide）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n300"><a class="md-toc-inner" href="#4135modmodulo）">4.1.3.5　MOD（MODulo）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n307"><a class="md-toc-inner" href="#414位元運算指令">4.1.4　位元運算指令</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n308"><a class="md-toc-inner" href="#4141andand）">4.1.4.1　AND（AND）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n314"><a class="md-toc-inner" href="#4142oror）">4.1.4.2　OR（OR）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n320"><a class="md-toc-inner" href="#4143notnot）">4.1.4.3　NOT（NOT）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n326"><a class="md-toc-inner" href="#4144xorexclusive-or）">4.1.4.4　XOR（eXclusive OR）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n332"><a class="md-toc-inner" href="#4145shlshift-left-arithmetic）">4.1.4.5　SHL（SHift Left, arithmetic）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n338"><a class="md-toc-inner" href="#4146shrshift-right-arithmetic）">4.1.4.6　SHR（SHift Right, arithmetic）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n345"><a class="md-toc-inner" href="#415邏輯運算指令">4.1.5　邏輯運算指令</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n346"><a class="md-toc-inner" href="#4151eqequal）">4.1.5.1　EQ（EQual）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n352"><a class="md-toc-inner" href="#4152nenot-equal）">4.1.5.2　NE（Not Equal）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n358"><a class="md-toc-inner" href="#4153leless-than-or-equal-to）">4.1.5.3　LE（Less than or Equal to）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n364"><a class="md-toc-inner" href="#4154ltless-than）">4.1.5.4　LT（Less Than）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n370"><a class="md-toc-inner" href="#4155gegreate-than-or-equal-to）">4.1.5.5　GE（Greate than or Equal to）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n376"><a class="md-toc-inner" href="#4156gtgreate-than）">4.1.5.6　GT（Greate Than）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n382"><a class="md-toc-inner" href="#4157invinvert）">4.1.5.7　INV（INVert）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n389"><a class="md-toc-inner" href="#416載入與儲存指令">4.1.6　載入與儲存指令</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n390"><a class="md-toc-inner" href="#4161ldbload-byte）">4.1.6.1　LDB（LoaD Byte）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n396"><a class="md-toc-inner" href="#4162stbstore-byte）">4.1.6.2　STB（STore Byte）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n402"><a class="md-toc-inner" href="#4163ldwload-word）">4.1.6.3　LDW（LoaD Word）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n408"><a class="md-toc-inner" href="#4164stwstore-word）">4.1.6.4　STW（STore Word）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n414"><a class="md-toc-inner" href="#4165llaload-label-address）">4.1.6.5　LLA（Load Label Address）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n421"><a class="md-toc-inner" href="#417轉跳指令">4.1.7　轉跳指令</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n422"><a class="md-toc-inner" href="#4171jmpjump）">4.1.7.1　JMP（JuMP）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n428"><a class="md-toc-inner" href="#4172jitjump-if-true）">4.1.7.2　JIT（Jump If True）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n435"><a class="md-toc-inner" href="#418函數相關指令">4.1.8　函數相關指令</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n437"><a class="md-toc-inner" href="#4181callcall）">4.1.8.1　CALL（CALL）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n443"><a class="md-toc-inner" href="#4182retreturn）">4.1.8.2　RET（RETurn）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n449"><a class="md-toc-inner" href="#4183setargset-argument-by-index）">4.1.8.3　SETARG（SET ARGument by index）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n455"><a class="md-toc-inner" href="#4184getargget-argument-by-index）">4.1.8.4　GETARG（GET ARGument by index）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n461"><a class="md-toc-inner" href="#4185setretset-return-value-by-index）">4.1.8.5　SETRET（SET RETurn value by index）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n467"><a class="md-toc-inner" href="#4186getretget-return-value-by-index）">4.1.8.6　GETRET（GET RETurn value by index）</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n474"><a class="md-toc-inner" href="#42與-sprite-c-語言之對應">4.2　與 Sprite C 語言之對應</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n477"><a class="md-toc-inner" href="#421表達式">4.2.1　表達式</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n488"><a class="md-toc-inner" href="#422條件判斷">4.2.2　條件判斷</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n499"><a class="md-toc-inner" href="#423迴圈">4.2.3　迴圈</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n507"><a class="md-toc-inner" href="#423函數呼叫">4.2.3　函數呼叫</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n515"><a class="md-toc-inner" href="#424陣列">4.2.4　陣列</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n523"><a class="md-toc-inner" href="#425結構體">4.2.5　結構體</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n535"><a class="md-toc-inner" href="#426位址運算元">4.2.6　位址運算元</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n546"><a class="md-toc-inner" href="#43與-rv32i-組合語言之對應">4.3　與 RV32I 組合語言之對應</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n662"><a class="md-toc-inner" href="#431乘法除法和餘數指令的替代方案">4.3.1　乘法、除法和餘數指令的替代方案</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n665"><a class="md-toc-inner" href="#4311乘法">4.3.1.1　乘法</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n670"><a class="md-toc-inner" href="#4312除法">4.3.1.2　除法</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n675"><a class="md-toc-inner" href="#4313餘數">4.3.1.3　餘數</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n680"><a class="md-toc-inner" href="#4314編譯器處理建議">4.3.1.4　編譯器處理建議</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n692"><a class="md-toc-inner" href="#432載入與儲存指令的對應">4.3.2　載入與儲存指令的對應</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n716"><a class="md-toc-inner" href="#433轉跳指令的對應">4.3.3　轉跳指令的對應</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n743"><a class="md-toc-inner" href="#434函數相關指令的對應">4.3.4　函數相關指令的對應</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n747"><a class="md-toc-inner" href="#44程式生成之-sil-檔格式">4.4　程式生成之 .sil 檔格式</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n752"><a class="md-toc-inner" href="#441函數區">4.4.1　函數區</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n755"><a class="md-toc-inner" href="#442符號表區">4.4.2　符號表區</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n758"><a class="md-toc-inner" href="#443字串表區">4.4.3　字串表區</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n761"><a class="md-toc-inner" href="#444範例">4.4.4　範例</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n769"><a class="md-toc-inner" href="#45未來規劃">4.5　未來規劃</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n780"><a class="md-toc-inner" href="#參考資料-2">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n795"><a class="md-toc-inner" href="#chapter-5rv32i">Chapter 5　RV32I</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n799"><a class="md-toc-inner" href="#引言-3">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n804"><a class="md-toc-inner" href="#51rv32i-機器語言">5.1　RV32I 機器語言</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n805"><a class="md-toc-inner" href="#511r-type">5.1.1　R type</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n824"><a class="md-toc-inner" href="#5111addadd）">5.1.1.1　ADD（ADD）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n835"><a class="md-toc-inner" href="#5112subsubstract）">5.1.1.2　SUB（SUBstract）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n846"><a class="md-toc-inner" href="#5113sllshift-left-logical）">5.1.1.3　SLL（Shift Left Logical）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n857"><a class="md-toc-inner" href="#5114slt-set-if-less-than">5.1.1.4　SLT (Set if Less Than)</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n866"><a class="md-toc-inner" href="#5115sltuset-if-less-than-unsigned）">5.1.1.5　SLTU（Set if Less Than, Unsigned）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n875"><a class="md-toc-inner" href="#5116xorexclusive-or）">5.1.1.6　XOR（eXclusive-OR）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n884"><a class="md-toc-inner" href="#5117srlshift-right-logical）">5.1.1.7　SRL（Shift Right Logical）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n895"><a class="md-toc-inner" href="#5118srashift-right-arithmetic）">5.1.1.8　SRA（Shift Right Arithmetic）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n906"><a class="md-toc-inner" href="#5119oror）">5.1.1.9　OR（OR）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n915"><a class="md-toc-inner" href="#51110andand）">5.1.1.10　AND（AND）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n924"><a class="md-toc-inner" href="#512i-type">5.1.2　I type</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n941"><a class="md-toc-inner" href="#5121lbload-byte）">5.1.2.1　LB（Load Byte）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n950"><a class="md-toc-inner" href="#5122lhload-halfword）">5.1.2.2　LH（Load Halfword）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n961"><a class="md-toc-inner" href="#5123lwload-word）">5.1.2.3　LW（Load Word）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n972"><a class="md-toc-inner" href="#5124lbuload-byte-unsigned）">5.1.2.4　LBU（Load Byte, Unsigned）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n981"><a class="md-toc-inner" href="#5125lhuload-halfword-unsigned）">5.1.2.5　LHU（Load Halfword, Unsigned）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n992"><a class="md-toc-inner" href="#5126addiadd-immediate）">5.1.2.6　ADDI（ADD Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1005"><a class="md-toc-inner" href="#5127sltiset-if-less-then-immediate）">5.1.2.7　SLTI（Set if Less Then Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1014"><a class="md-toc-inner" href="#5128sltiuset-if-less-then-immediate-unsigned）">5.1.2.8　SLTIU（Set if Less Then Immediate, Unsigned）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1023"><a class="md-toc-inner" href="#5129xoriexclusive-or-immediate）">5.1.2.9　XORI（eXclusive-OR Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1032"><a class="md-toc-inner" href="#51210orior-immediate）">5.1.2.10　ORI（OR Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1041"><a class="md-toc-inner" href="#51211andiand-immediate）">5.1.2.11　ANDI（AND Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1050"><a class="md-toc-inner" href="#51212sllishift-left-logical-immediate）">5.1.2.12　SLLI（Shift Left Logical Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1063"><a class="md-toc-inner" href="#51213srlishift-right-logical-immediate）">5.1.2.13　SRLI（Shift Right Logical Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1074"><a class="md-toc-inner" href="#51214sraishift-right-arithmetic-immediate）">5.1.2.14　SRAI（Shift Right Arithmetic Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1085"><a class="md-toc-inner" href="#51215jalrjump-and-link-register）">5.1.2.15　JALR（Jump And Link Register）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1096"><a class="md-toc-inner" href="#51216ecallenvironment-call舊稱-scall）">5.1.2.16　ECALL（Environment CALL，舊稱 SCALL）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1107"><a class="md-toc-inner" href="#51217ebreakenvironment-breakpoint舊稱-sbreak）">5.1.2.17　EBREAK（Environment BREAKpoint，舊稱 SBREAK）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1116"><a class="md-toc-inner" href="#51218fencefence）">5.1.2.18　FENCE（FENCE）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1154"><a class="md-toc-inner" href="#513s-type--b-type">5.1.3　S type &amp; B type</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1194"><a class="md-toc-inner" href="#5131sbstore-byte）">5.1.3.1　SB（Store Byte）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1205"><a class="md-toc-inner" href="#5132shstore-halfword）">5.1.3.2　SH（Store Halfword）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1214"><a class="md-toc-inner" href="#5133swstore-word）">5.1.3.3　SW（Store Word）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1223"><a class="md-toc-inner" href="#5134beqbranch-if-equal）">5.1.3.4　BEQ（Branch if EQual）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1232"><a class="md-toc-inner" href="#5135bnebranch-if-not-equal）">5.1.3.5　BNE（Branch if Not Equal）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1241"><a class="md-toc-inner" href="#5136bltbranch-if-less-than）">5.1.3.6　BLT（Branch if Less Than）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1250"><a class="md-toc-inner" href="#5137bgebranch-if-greater-than-or-equal）">5.1.3.7　BGE（Branch if Greater than or Equal）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1259"><a class="md-toc-inner" href="#5138bltubranch-if-less-than-unsigned）">5.1.3.8　BLTU（Branch if Less Than, Unsigned）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1268"><a class="md-toc-inner" href="#5139bgeubranch-if-greater-than-or-equal-unsigned）">5.1.3.9　BGEU（Branch if Greater than or Equal, Unsigned）</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1277"><a class="md-toc-inner" href="#514u-type---j-type">5.1.4　U type  &amp; J type</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1308"><a class="md-toc-inner" href="#5141luiload-upper-immediate）">5.1.4.1　LUI（Load Upper Immediate）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1319"><a class="md-toc-inner" href="#5142auipcadd-upper-immediate-to-program-counter）">5.1.4.2　AUIPC（Add Upper Immediate to Program Counter）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1330"><a class="md-toc-inner" href="#5143jaljump-and-link）">5.1.4.3　JAL（Jump And Link）</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1339"><a class="md-toc-inner" href="#52rv32i-組合語言">5.2　RV32I 組合語言</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1340"><a class="md-toc-inner" href="#521暫存器命名慣例">5.2.1　暫存器命名慣例</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1405"><a class="md-toc-inner" href="#522偽指令">5.2.2　偽指令</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1543"><a class="md-toc-inner" href="#523程式實例">5.2.3　程式實例</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1544"><a class="md-toc-inner" href="#5231變數交換">5.2.3.1　變數交換</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1551"><a class="md-toc-inner" href="#5232大數加法">5.2.3.2　大數加法</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1556"><a class="md-toc-inner" href="#5233檢查溢位">5.2.3.3　檢查溢位</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1563"><a class="md-toc-inner" href="#5234函數編寫">5.2.3.4　函數編寫</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1568"><a class="md-toc-inner" href="#參考資料-3">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1590"><a class="md-toc-inner" href="#chapter-6sprite-executable-format">Chapter 6　Sprite Executable Format</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1594"><a class="md-toc-inner" href="#引言-4">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1595"><a class="md-toc-inner" href="#61現有格式回顧">6.1　現有格式回顧</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1596"><a class="md-toc-inner" href="#611aout">6.1.1　a.out</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1597"><a class="md-toc-inner" href="#612elf">6.1.2　ELF</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1598"><a class="md-toc-inner" href="#613pe">6.1.3　PE</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1599"><a class="md-toc-inner" href="#614mach-o">6.1.4　Mach-O</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1600"><a class="md-toc-inner" href="#62檔案格式">6.2　檔案格式</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1601"><a class="md-toc-inner" href="#621object">6.2.1　Object</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1602"><a class="md-toc-inner" href="#622executable">6.2.2　Executable</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1603"><a class="md-toc-inner" href="#63未來規劃">6.3　未來規劃</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1604"><a class="md-toc-inner" href="#參考資料-4">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1606"><a class="md-toc-inner" href="#chapter-7編譯器">Chapter 7　編譯器</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1610"><a class="md-toc-inner" href="#引言-5">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1611"><a class="md-toc-inner" href="#71名詞定義">7.1　名詞定義</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1612"><a class="md-toc-inner" href="#71n標記">7.1.n　標記</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1614"><a class="md-toc-inner" href="#71n標記流">7.1.n　標記流</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1616"><a class="md-toc-inner" href="#71n詞法分析">7.1.n　詞法分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1619"><a class="md-toc-inner" href="#71n語法分析">7.1.n　語法分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1622"><a class="md-toc-inner" href="#71n語意分析">7.1.n　語意分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1625"><a class="md-toc-inner" href="#71n抽象語法樹">7.1.n　抽象語法樹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1628"><a class="md-toc-inner" href="#71n符號表">7.1.n　符號表</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1630"><a class="md-toc-inner" href="#72使用者介面">7.2　使用者介面</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1631"><a class="md-toc-inner" href="#73詞法分析">7.3　詞法分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1632"><a class="md-toc-inner" href="#73n錯誤處理">7.3.n　錯誤處理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1633"><a class="md-toc-inner" href="#74抽象語法樹結構">7.4　抽象語法樹結構</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1634"><a class="md-toc-inner" href="#75符號表">7.5　符號表</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1635"><a class="md-toc-inner" href="#76語法分析">7.6　語法分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1636"><a class="md-toc-inner" href="#76n錯誤處理">7.6.n　錯誤處理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1637"><a class="md-toc-inner" href="#77語意分析">7.7　語意分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1638"><a class="md-toc-inner" href="#77n錯誤處理">7.7.n　錯誤處理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1639"><a class="md-toc-inner" href="#78中間語言生成">7.8　中間語言生成</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1640"><a class="md-toc-inner" href="#79機器無關優化">7.9　機器無關優化</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1641"><a class="md-toc-inner" href="#791抽象語法樹優化">7.9.1　抽象語法樹優化</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1642"><a class="md-toc-inner" href="#7911表達式簡化">7.9.1.1　表達式簡化</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1643"><a class="md-toc-inner" href="#7912常數折疊">7.9.1.2　常數折疊</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1644"><a class="md-toc-inner" href="#7913死碼刪除">7.9.1.3　死碼刪除</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1645"><a class="md-toc-inner" href="#792中間語言優化">7.9.2　中間語言優化</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1646"><a class="md-toc-inner" href="#7921尾遞迴消除">7.9.2.1　尾遞迴消除</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1647"><a class="md-toc-inner" href="#710sil-檔案生成">7.10　.sil 檔案生成</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1648"><a class="md-toc-inner" href="#711未來規劃">7.11　未來規劃</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1649"><a class="md-toc-inner" href="#參考資料-5">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1651"><a class="md-toc-inner" href="#chapter-8組譯器">Chapter 8　組譯器</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1655"><a class="md-toc-inner" href="#引言-6">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1656"><a class="md-toc-inner" href="#81名詞定義">8.1　名詞定義</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1657"><a class="md-toc-inner" href="#82用者介面">8.2　用者介面</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1658"><a class="md-toc-inner" href="#83詞法分析">8.3　詞法分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1659"><a class="md-toc-inner" href="#83n錯誤處理">8.3.n　錯誤處理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1660"><a class="md-toc-inner" href="#84語法分析">8.4　語法分析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1661"><a class="md-toc-inner" href="#84n錯誤處理">8.4.n　錯誤處理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1662"><a class="md-toc-inner" href="#85機器語言生成">8.5　機器語言生成</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1663"><a class="md-toc-inner" href="#86機器相關優化">8.6　機器相關優化</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1664"><a class="md-toc-inner" href="#861零暫存器取代">8.6.1　零暫存器取代</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1665"><a class="md-toc-inner" href="#87sof-檔案生成">8.7　.sof 檔案生成</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1666"><a class="md-toc-inner" href="#88未來規劃">8.8　未來規劃</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1667"><a class="md-toc-inner" href="#參考資料-6">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1669"><a class="md-toc-inner" href="#chapter-9連結器">Chapter 9　連結器</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1673"><a class="md-toc-inner" href="#引言-7">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1674"><a class="md-toc-inner" href="#91名詞定義">9.1　名詞定義</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1675"><a class="md-toc-inner" href="#92使用者介面">9.2　使用者介面</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1676"><a class="md-toc-inner" href="#93符號解析">9.3　符號解析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1677"><a class="md-toc-inner" href="#93n錯誤處理">9.3.n　錯誤處理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1678"><a class="md-toc-inner" href="#94空間分配">9.4　空間分配</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1679"><a class="md-toc-inner" href="#95重定位">9.5　重定位</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1680"><a class="md-toc-inner" href="#96se-檔案生成">9.6　.se 檔案生成</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1681"><a class="md-toc-inner" href="#97未來規劃">9.7　未來規劃</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1682"><a class="md-toc-inner" href="#參考資料-7">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1684"><a class="md-toc-inner" href="#chapter-10仿真器">Chapter 10　仿真器</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1688"><a class="md-toc-inner" href="#引言-8">引言</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1689"><a class="md-toc-inner" href="#101名詞定義">10.1　名詞定義</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1690"><a class="md-toc-inner" href="#102se-檔案運行環境">10.2　.se 檔案運行環境</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1691"><a class="md-toc-inner" href="#1021指令集">10.2.1　指令集</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1692"><a class="md-toc-inner" href="#1022架構">10.2.2　架構</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1693"><a class="md-toc-inner" href="#1023暫存器">10.2.3　暫存器</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1694"><a class="md-toc-inner" href="#1024記憶體">10.2.4　記憶體</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1695"><a class="md-toc-inner" href="#1025庫函數支援">10.2.5　庫函數支援</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1696"><a class="md-toc-inner" href="#103反組譯器">10.3　反組譯器</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1697"><a class="md-toc-inner" href="#104圖形化介面設計">10.4　圖形化介面設計</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1698"><a class="md-toc-inner" href="#105未來規劃">10.5　未來規劃</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1699"><a class="md-toc-inner" href="#參考資料-8">參考資料</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1701"><a class="md-toc-inner" href="#變更紀錄">變更紀錄</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1806"><a class="md-toc-inner" href="#版本號更新規則">版本號更新規則</a></span></p></div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='摘要'><span>摘要</span></h1><hr /><p style="text-align:right;"><a href="#目錄">回目錄</a></p><p><span>　　本文件旨在透過綜合自今年二月以來所有組員對負責領域的知識，於實作前探討程式架構與可能遇到的問題。文件首先會以自上而下的角度展開從原始碼到仿真的過程，再根據細項分章節進行討論、敲定細節，最終得到可行的初版架構。</span></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-1名詞定義'><span>Chapter 1　名詞定義</span></h1><hr /><left>作者：陳忠義</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='11語言類'><span>1.1　語言類</span></h2><h3 id='111sprite-c'><span>1.1.1　Sprite C</span></h3><p><span>　　Sprite C 為參考 C 語言為所設計的程式語言，縮寫為 SC。以 Sprite C 寫成的原始碼，其副檔名應以 .sc 標示。</span></p><h3 id='112sprite-intermediate-language'><span>1.1.2　Sprite Intermediate Language</span></h3><p><span>　　Sprite Intermediate Language 為本次專題所使用的中間語言，縮寫為 SIL，是編譯器根據 SC 原始碼所轉換的目標語言。</span></p><h3 id='113rv32i'><span>1.1.3　RV32I</span></h3><p><span>　　RV32I 指 </span><em><span>The RISC-V Instruction Set Manual, Volumn 1, version 20191213</span></em><span> 中定義的 RV32I 核心整數指令集，是組譯器根據 SIL 轉換的目標指令集。</span></p><p>&nbsp;</p><h2 id='12格式類'><span>1.2　格式類</span></h2><h3 id='121sprite-object-file'><span>1.2.1　Sprite Object File</span></h3><p><span>　　Sprite Object File 為組譯器輸出的檔案，以副檔名 .sof 標示（與 .o 和 .so 有所區別），包含 RV32I 機器碼與連結器所需資訊。</span></p><h3 id='122sprite-executable-file'><span>1.2.2　Sprite Executable File</span></h3><p><span>　　Sprite Executable File 為連結器輸出的檔案，以副檔名 .se 標示，可在仿真器上運行。</span></p><p>&nbsp;</p><h2 id='13程式類'><span>1.3　程式類</span></h2><h3 id='131編譯器'><span>1.3.1　編譯器</span></h3><p><span>　　編譯器指將 SC 原始碼轉換為 SIL 的程式。</span></p><h3 id='132組譯器'><span>1.3.2　組譯器</span></h3><p><span>　　組譯器指將 SIL 轉換至 RV32I 機器碼的程式。</span></p><h3 id='133連結器'><span>1.3.3　連結器</span></h3><p><span>　　連結器指用於執行編譯期連結的程式，對 RV32I 機器碼檔案進行編譯期連結，生成仿真器可執行的 .se 檔案。</span></p><h3 id='134仿真器'><span>1.3.4　仿真器</span></h3><p><span>　　仿真器指用來執行 .se 檔的程式，由反組譯、執行和可視化界面組成。</span></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-2流程－以-testsc-為例'><span>Chapter 2　流程－以 test.sc 為例</span></h1><hr /><left>作者：陳忠義</left><p style="text-align:right;"><a href="#contents">回目錄</a></p><h2 id='21使用者視角'><span>2.1　使用者視角</span></h2><center>表 2.1：使用者視角的工具鏈使用流程</center><figure><table><thead><tr><th>&nbsp;</th><th><span>流程</span></th><th><span>輸入</span></th><th><span>輸出</span></th><th><span>相關程式</span></th></tr></thead><tbody><tr><td><strong><span>1</span></strong></td><td><span>撰寫 test.sc</span></td><td><span>-</span></td><td><span>test.sc</span></td><td><span>文字編輯軟體，跟本專題無關</span></td></tr><tr><td><strong><span>2</span></strong></td><td><span>編譯 test.sc</span></td><td><span>test.sc</span></td><td><span>test.sil</span></td><td><span>編譯器</span></td></tr><tr><td><strong><span>3</span></strong></td><td><span>組譯 test.sil</span></td><td><span>test.sil</span></td><td><span>test.sof</span></td><td><span>組譯器</span></td></tr><tr><td><strong><span>4</span></strong></td><td><span>連結 test.sof</span></td><td><span>test.sof</span></td><td><span>test.se</span></td><td><span>連結器</span></td></tr><tr><td><strong><span>5</span></strong></td><td><span>執行 test.se</span></td><td><span>test.se</span></td><td><span>-</span></td><td><span>仿真器</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2 id='22編譯器視角'><span>2.2　編譯器視角</span></h2><center>表 2.2：編譯器處理 test.sc 的流程</center><figure><table><thead><tr><th>&nbsp;</th><th><span>流程</span></th><th><span>輸入</span></th><th><span>輸出</span></th></tr></thead><tbody><tr><td><strong><span>1</span></strong></td><td><span>lexical analysis</span></td><td><span>test.sc</span></td><td><span>token stream</span></td></tr><tr><td><strong><span>2</span></strong></td><td><span>syntactic analysis</span></td><td><span>token stream</span></td><td><span>abstract syntax tree, AST</span></td></tr><tr><td><strong><span>3</span></strong></td><td><span>semantic analysis</span></td><td><span>AST</span></td><td><span>annotated AST</span></td></tr><tr><td><strong><span>4</span></strong></td><td><span>AST level operations</span></td><td><span>annotated AST</span></td><td><span>optimized AST</span></td></tr><tr><td><strong><span>5</span></strong></td><td><span>intermediate code generation</span></td><td><span>optimized AST</span></td><td><span>SIL code</span></td></tr><tr><td><strong><span>6</span></strong></td><td><span>intermediate code level operations (machine-independent)</span></td><td><span>SIL code</span></td><td><span>optimized SIL code</span></td></tr><tr><td><strong><span>7</span></strong></td><td><span>.sil file generation</span></td><td><span>optimized SIL code</span></td><td><span>test.sil</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2 id='23組譯器視角'><span>2.3　組譯器視角</span></h2><center>表 2.3：組譯器處理 test.sil 的流程</center><figure><table><thead><tr><th>&nbsp;</th><th><span>流程</span></th><th><span>輸入</span></th><th><span>輸出</span></th></tr></thead><tbody><tr><td><strong><span>1</span></strong></td><td><span>lexical analysis</span></td><td><span>test.sil</span></td><td><span>token stream</span></td></tr><tr><td><strong><span>2</span></strong></td><td><span>syntatic analysis</span></td><td><span>token stream</span></td><td><span>SIL code</span></td></tr><tr><td><strong><span>3</span></strong></td><td><span>intermediate code level operations (machine-dependent)</span></td><td><span>SIL code</span></td><td><span>optimized SIL code</span></td></tr><tr><td><strong><span>4</span></strong></td><td><span>machine code generation</span></td><td><span>optimized SIL code</span></td><td><span>RV32I machine code</span></td></tr><tr><td><strong><span>5</span></strong></td><td><span>.sof file generation</span></td><td><span>RV32I machine code &amp; some necessary tables</span></td><td><span>test.sof</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2 id='24連結器視角'><span>2.4　連結器視角</span></h2><center>表 2.4：連結器處理 test.sof 的流程</center><figure><table><thead><tr><th>&nbsp;</th><th><span>流程</span></th><th><span>輸入</span></th><th><span>輸出</span></th></tr></thead><tbody><tr><td><strong><span>1</span></strong></td><td><span>information collection</span></td><td><span>test.sof</span></td><td><span>some necessary tables</span></td></tr><tr><td><strong><span>2</span></strong></td><td><span>symbol resolution</span></td><td><span>symbol table(s)</span></td><td><span>-</span></td></tr><tr><td><strong><span>3</span></strong></td><td><span>storage allocation</span></td><td><span>machine code for test.sof &amp; used C library function</span></td><td><span>allocated machine code</span></td></tr><tr><td><strong><span>4</span></strong></td><td><span>relocation</span></td><td><span>allocated machine code</span></td><td><span>relocated machine code</span></td></tr><tr><td><strong><span>5</span></strong></td><td><span>.se file generation</span></td><td><span>relocated machine  code</span></td><td><span>test.se</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2 id='25仿真器視角'><span>2.5　仿真器視角</span></h2><center>表 2.5：仿真器執行 test.se 的流程</center><figure><table><thead><tr><th>&nbsp;</th><th><span>流程</span></th><th><span>輸入</span></th><th><span>輸出</span></th></tr></thead><tbody><tr><td><strong><span>1</span></strong></td><td><span>environment initialization</span></td><td><span>test.se</span></td><td><span>-</span></td></tr><tr><td><strong><span>2a</span></strong></td><td><span>instruction emulation</span></td><td><span>an instruction in test.se</span></td><td><span>screen</span></td></tr><tr><td><strong><span>2b</span></strong></td><td><span>instruction disassembly</span></td><td><span>an instruction in test.se</span></td><td><span>screen</span></td></tr><tr><td><strong><span>3</span></strong></td><td><span>user event handling</span></td><td><span>-</span></td><td><span>-</span></td></tr></tbody></table></figure><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-3sprite-c'><span>Chapter 3　Sprite C</span></h1><hr /><left>作者：待定</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-1'><span>引言</span></h2><h2 id='31資料型態'><span>3.1　資料型態</span></h2><h2 id='32關鍵字'><span>3.2　關鍵字</span></h2><h2 id='33運算子'><span>3.3　運算子</span></h2><h2 id='34詞法標記'><span>3.4　詞法標記</span></h2><h2 id='35文法'><span>3.5　文法</span></h2><h2 id='36未來規劃'><span>3.6　未來規劃</span></h2><h2 id='參考資料-1'><span>參考資料</span></h2><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-4sprite-intermediate-language'><span>Chapter 4　Sprite Intermediate Language</span></h1><hr /><left>作者：陳忠義、羅世瑋</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-2'><span>引言</span></h2><p><span>　　Sprite Intermediate Language 為機器無關的中間語言，使用三位址碼（three address code, TAC）形式，在設計上更加貼近高階語言。SIL 指令中的操作對象為數學概念上的變數，又或者說是無限多個、不限大小的虛擬暫存器，與物理上的暫存器無關。SIL 主體由基礎指令、算術運算指令、位元運算指令、邏輯運算指令、載入指令、儲存指令、轉跳指令和函數相關指令等七大類指令構成，幾乎所有的指令只接受變數運算元，若需要使用常數值進行運算，則要先利用 </span><code>IMM</code><span> 指令把常數值賦予變數，再利用該變數進行後續運算。另外我們在 SIL 中添加了與參數和回傳值相關的指令，用來隱藏呼叫慣例（calling convention）和實際的硬體設計。</span></p><p>&nbsp;</p><h2 id='41語法'><span>4.1　語法</span></h2><h3 id='411標籤與註解'><span>4.1.1　標籤與註解</span></h3><p><span>　　標籤（label）在 SIL 中代表某一指令或字串的位置，一個由英數字、底線（_）和點（.）組成，而註解（comment）為以分號（;）開頭的單行字串。</span></p><center>標籤與註解在 SIL 的範例</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">; SIL 的註解</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label_1:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; label_1 為標籤，代表 ADD 指令所在位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADD</span> <span class="cm-keyword">x</span>, y, z</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label_2:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; label_2 為標籤，代表字串 "this is a string" 的所在位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"this is a string"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 128px;"></div><div class="CodeMirror-gutters" style="display: none; height: 128px;"></div></div></div></pre><p>&nbsp;</p><h3 id='412基礎指令'><span>4.1.2　基礎指令</span></h3><h4 id='4121immimmediate）'><span>4.1.2.1　IMM（IMMediate）</span></h4><ul><li><span>語法：</span><code>IMM x, #immediate</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>immediate</code><span>，</span><code>immediate</code><span> 為常數</span></li></ul><h4 id='4122movmove）'><span>4.1.2.2　MOV（MOVe）</span></h4><ul><li><span>語法：</span><code>MOV x, y</code></li><li><span>行為：使 </span><code>x</code><span> 之值與 </span><code>y</code><span> 之值相同</span></li></ul><h4 id='4123nopno-operation）'><span>4.1.2.3　NOP（No OPeration）</span></h4><ul><li><span>語法：</span><code>NOP</code></li><li><span>行為：沒有</span></li></ul><p>&nbsp;</p><h3 id='413算術運算指令'><span>4.1.3　算術運算指令</span></h3><h4 id='4131add-add）'><span>4.1.3.1　ADD （ADD）</span></h4><ul><li><span>語法：</span><code>ADD x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 之和</span></li></ul><h4 id='4132subsubstract）'><span>4.1.3.2　SUB（SUBstract）</span></h4><ul><li><span>語法：</span><code>SUB x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 之差</span></li></ul><h4 id='4133mulmultiply）'><span>4.1.3.3　MUL（MULtiply）</span></h4><ul><li><span>語法：</span><code>MUL x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 之積</span></li></ul><h4 id='4134divdivide）'><span>4.1.3.4　DIV（DIVide）</span></h4><ul><li><span>語法：</span><code>DIV x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 之商</span></li></ul><h4 id='4135modmodulo）'><span>4.1.3.5　MOD（MODulo）</span></h4><ul><li><span>語法：</span><code>MOD x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 之餘</span></li></ul><p>&nbsp;</p><h3 id='414位元運算指令'><span>4.1.4　位元運算指令</span></h3><h4 id='4141andand）'><span>4.1.4.1　AND（AND）</span></h4><ul><li><span>語法：</span><code>AND x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 按位元取且之結果</span></li></ul><h4 id='4142oror）'><span>4.1.4.2　OR（OR）</span></h4><ul><li><span>語法：</span><code>OR x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 按位元取或之結果</span></li></ul><h4 id='4143notnot）'><span>4.1.4.3　NOT（NOT）</span></h4><ul><li><span>語法：</span><code>NOT x, y</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 按位元取反之結果</span></li></ul><h4 id='4144xorexclusive-or）'><span>4.1.4.4　XOR（eXclusive OR）</span></h4><ul><li><span>語法：</span><code>XOR x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 與 </span><code>z</code><span> 按位元取互斥或之結果</span></li></ul><h4 id='4145shlshift-left-arithmetic）'><span>4.1.4.5　SHL（SHift Left, arithmetic）</span></h4><ul><li><span>語法：</span><code>SHL x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 之值算數左移 </span><code>z</code><span> 位之結果</span></li></ul><h4 id='4146shrshift-right-arithmetic）'><span>4.1.4.6　SHR（SHift Right, arithmetic）</span></h4><ul><li><span>語法：</span><code>SHR x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>y</code><span> 之值算數右移 </span><code>z</code><span> 位之結果</span></li></ul><p>&nbsp;</p><h3 id='415邏輯運算指令'><span>4.1.5　邏輯運算指令</span></h3><h4 id='4151eqequal）'><span>4.1.5.1　EQ（EQual）</span></h4><ul><li><span>語法：</span><code>EQ x, y, z</code></li><li><span>行為：若 </span><code>y</code><span> 之值等於 </span><code>z</code><span> 之值，使 </span><code>x</code><span> 之值為 </span><code>1</code><span>，否則為 </span><code>0</code></li></ul><h4 id='4152nenot-equal）'><span>4.1.5.2　NE（Not Equal）</span></h4><ul><li><span>語法：</span><code>NE x, y, z</code></li><li><span>行為：若 </span><code>y</code><span> 之值不等於 </span><code>z</code><span> 之值，使 </span><code>x</code><span> 之值為 </span><code>1</code><span>，否則為 </span><code>0</code></li></ul><h4 id='4153leless-than-or-equal-to）'><span>4.1.5.3　LE（Less than or Equal to）</span></h4><ul><li><span>語法：</span><code>LE x, y, z</code></li><li><span>行為：若 </span><code>y</code><span> 之值小於或等於 </span><code>z</code><span> 之值，使 </span><code>x</code><span> 之值為 </span><code>1</code><span>，否則為 </span><code>0</code></li></ul><h4 id='4154ltless-than）'><span>4.1.5.4　LT（Less Than）</span></h4><ul><li><span>語法：</span><code>LT x, y, z</code></li><li><span>行為：若 </span><code>y</code><span> 之值小於 </span><code>z</code><span> 之值，使 </span><code>x</code><span> 之值為 </span><code>1</code><span>，否則為 </span><code>0</code></li></ul><h4 id='4155gegreate-than-or-equal-to）'><span>4.1.5.5　GE（Greate than or Equal to）</span></h4><ul><li><span>語法：</span><code>GE x, y, z</code></li><li><span>行為：若 </span><code>y</code><span> 之值大於或等於 </span><code>z</code><span> 之值，使 </span><code>x</code><span> 之值為 </span><code>1</code><span>，否則為 </span><code>0</code></li></ul><h4 id='4156gtgreate-than）'><span>4.1.5.6　GT（Greate Than）</span></h4><ul><li><span>語法：</span><code>GT x, y, z</code></li><li><span>行為：若 </span><code>y</code><span> 之值大於 </span><code>z</code><span> 之值，使 </span><code>x</code><span> 之值為 </span><code>1</code><span>，否則為 </span><code>0</code></li></ul><h4 id='4157invinvert）'><span>4.1.5.7　INV（INVert）</span></h4><ul><li><span>語法：</span><code>INV x, y</code></li><li><span>行為：若 </span><code>y</code><span> 之值為 </span><code>0</code><span>，使 </span><code>x</code><span> 之值為 </span><code>1</code><span>，若 </span><code>y</code><span> 之值不為 </span><code>0</code><span>，使 </span><code>x</code><span> 之值為 </span><code>0</code></li></ul><p>&nbsp;</p><h3 id='416載入與儲存指令'><span>4.1.6　載入與儲存指令</span></h3><h4 id='4161ldbload-byte）'><span>4.1.6.1　LDB（LoaD Byte）</span></h4><ul><li><span>語法：</span><code>LDB x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為以記憶體位址 </span><code>y + z</code><span>  起始取一個位元組之結果</span></li></ul><h4 id='4162stbstore-byte）'><span>4.1.6.2　STB（STore Byte）</span></h4><ul><li><span>語法：</span><code>STB x, y, z</code></li><li><span>行為：使以記憶體位址 </span><code>y + z</code><span>  起始的位元組為 </span><code>x</code><span> 的最低有效位元組</span></li></ul><h4 id='4163ldwload-word）'><span>4.1.6.3　LDW（LoaD Word）</span></h4><ul><li><span>語法：</span><code>LDW x, y, z</code></li><li><span>行為：使 </span><code>x</code><span> 之值為以記憶體位址 </span><code>y + z</code><span>  起始取連續四個位元組之結果</span></li></ul><h4 id='4164stwstore-word）'><span>4.1.6.4　STW（STore Word）</span></h4><ul><li><span>語法：</span><code>STW x, y, z</code></li><li><span>行為：使以記憶體位址 </span><code>y + z</code><span>  起始的連續四個位元組為 </span><code>x</code><span> 的末四個有效位元組</span></li></ul><h4 id='4165llaload-label-address）'><span>4.1.6.5　LLA（Load Label Address）</span></h4><ul><li><span>語法：</span><code>LLA x, label</code></li><li><span>行為：使 </span><code>x</code><span> 之值為 </span><code>label</code><span> 所在位置</span></li></ul><p>&nbsp;</p><h3 id='417轉跳指令'><span>4.1.7　轉跳指令</span></h3><h4 id='4171jmpjump）'><span>4.1.7.1　JMP（JuMP）</span></h4><ul><li><span>語法：</span><code>JMP label</code></li><li><span>行為：無條件轉跳至 </span><code>label</code><span> 所在位置</span></li></ul><h4 id='4172jitjump-if-true）'><span>4.1.7.2　JIT（Jump If True）</span></h4><ul><li><span>語法：</span><code>JIT x, label</code></li><li><span>行為：若 </span><code>x</code><span> 之值非 </span><code>0</code><span>，轉跳至 </span><code>label</code><span> 所在位置</span></li></ul><p>&nbsp;</p><h3 id='418函數相關指令'><span>4.1.8　函數相關指令</span></h3><p><span>　　為了抽象化函數的呼叫過程，我們制定 </span><code>SETARG</code><span> 等四個特殊指令，用以處理參數和回傳值的傳遞問題，這麼做的好處是可以在中間語言層面隱藏底層機器的 ABI 相關規定，將傳遞方式延遲到機器語言生成時再行決定。</span></p><h4 id='4181callcall）'><span>4.1.8.1　CALL（CALL）</span></h4><ul><li><span>語法：</span><code>CALL function</code></li><li><span>行為：轉跳至 </span><code>function</code><span> 所在位置</span></li></ul><h4 id='4182retreturn）'><span>4.1.8.2　RET（RETurn）</span></h4><ul><li><span>語法：</span><code>RET</code></li><li><span>行為：自函數中返回</span></li></ul><h4 id='4183setargset-argument-by-index）'><span>4.1.8.3　SETARG（SET ARGument by index）</span></h4><ul><li><span>語法：</span><code>SETARG x, #index</code></li><li><span>行為：將 </span><code>x</code><span> 之值設為第 </span><code>index</code><span> 個參數</span></li></ul><h4 id='4184getargget-argument-by-index）'><span>4.1.8.4　GETARG（GET ARGument by index）</span></h4><ul><li><span>語法：</span><code>GETARG x, #index</code></li><li><span>行為：取得第 </span><code>index</code><span> 個參數，並以該值設定 </span><code>x</code></li></ul><h4 id='4185setretset-return-value-by-index）'><span>4.1.8.5　SETRET（SET RETurn value by index）</span></h4><ul><li><span>語法：</span><code>SETRET x, #index</code></li><li><span>行為：將 </span><code>x</code><span> 之值設為第 </span><code>index</code><span> 個回傳值</span></li></ul><h4 id='4186getretget-return-value-by-index）'><span>4.1.8.6　GETRET（GET RETurn value by index）</span></h4><ul><li><span>語法：</span><code>GETRET x, #index</code></li><li><span>行為：取得第 </span><code>index</code><span> 個回傳值，並以該值設定 </span><code>x</code></li></ul><p>&nbsp;</p><h2 id='42與-sprite-c-語言之對應'><span>4.2　與 Sprite C 語言之對應</span></h2><p><span>　　Sprite C 如何翻譯至 SIL 主要看編譯器編寫者如何設計，這涉及到大量不同的優化方式，很難達到一對一的對應，以下範例在省略掉優化的情況下，用人類的角度提供可能的程式翻譯結果。</span></p><p>&nbsp;</p><h3 id='421表達式'><span>4.2.1　表達式</span></h3><p><span>　　由於 SIL 中的常數要透過 </span><code>IMM</code><span> 指令創造，可以先將表達式轉換為逆波蘭表示法（reverse Polish notation），方便加入 </span><code>IMM</code><span> 指令，再把逆波蘭表示法轉為 SIL 指令，這是比較結構化和便於理解的方法。實際上編譯器可以將 </span><code>(1+2)*(3-4) + (4/2)*(6%5)</code><span> 直接優化成 </span><code>5</code><span>，大幅節約程式碼大小和增加運行速度。</span></p><center>Sprite C 表達式範例</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="C"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">var</span> <span class="cm-operator">=</span> <span class="cm-variable">x</span> <span class="cm-operator">&lt;&lt;</span> ((<span class="cm-number">1</span><span class="cm-operator">+</span><span class="cm-number">2</span>)<span class="cm-operator">*</span>(<span class="cm-number">4</span><span class="cm-operator">-</span><span class="cm-number">3</span>) <span class="cm-operator">+</span> (<span class="cm-number">4</span><span class="cm-operator">/</span><span class="cm-number">2</span>)<span class="cm-operator">*</span>(<span class="cm-number">6</span><span class="cm-operator">%</span><span class="cm-number">5</span>)) <span class="cm-comment">/* assume x is defined somewhere and also reachable */</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="display: none; height: 26px;"></div></div></div></pre><p>&nbsp;</p><center>以逆波蘭表示法表示的表達式</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">n</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-number">3</span> <span class="cm-number">4</span> <span class="cm-operator">-</span> <span class="cm-operator">*</span> <span class="cm-number">4</span> <span class="cm-number">2</span> <span class="cm-operator">/</span> <span class="cm-number">6</span> <span class="cm-number">5</span> <span class="cm-operator">%</span> <span class="cm-operator">*</span> <span class="cm-operator">+</span> <span class="cm-operator">&lt;&lt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="display: none; height: 26px;"></div></div></div></pre><p>&nbsp;</p><center>表達式相應的 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, <span class="cm-comment">#1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, t1, t2 &nbsp; &nbsp;<span class="cm-comment">; 1+2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t4</span>, <span class="cm-comment">#3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t5</span>, <span class="cm-comment">#4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t6</span>, t4, t5 &nbsp; &nbsp;<span class="cm-comment">; 4-3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t7</span>, t3, t6 &nbsp; &nbsp;<span class="cm-comment">; (1+2)*(4-3)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t8</span>, <span class="cm-comment">#4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t9</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">DIV</span> &nbsp; &nbsp; <span class="cm-keyword">t10</span>, t8, t9 &nbsp; <span class="cm-comment">; (4/2)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t11</span>, <span class="cm-comment">#6</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t12</span>, <span class="cm-comment">#5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOD</span> &nbsp; &nbsp; <span class="cm-keyword">t13</span>, t11, t12 <span class="cm-comment">; (6%5)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t14</span>, t10, t13 <span class="cm-comment">; (4/2)*(6%5)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">t15</span>, t7, t14 &nbsp;<span class="cm-comment">; (1+2)*(4-3) + (4/2)*(6%5)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SHL</span> &nbsp; &nbsp; <span class="cm-keyword">t16</span>, x, t15 &nbsp; <span class="cm-comment">; x &lt;&lt; ((1+2)*(4-3) + (4/2)*(6%5))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">var</span>, t16 &nbsp; &nbsp; &nbsp;<span class="cm-comment">; var = x &lt;&lt; ((1+2)*(4-3) + (4/2)*(6%5))</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 435px;"></div><div class="CodeMirror-gutters" style="display: none; height: 435px;"></div></div></div></pre><p>&nbsp;</p><h3 id='422條件判斷'><span>4.2.2　條件判斷</span></h3><p><span>　　在 Sprite C 中的條件判斷語句可以使用 </span><code>else if</code><span> 關鍵字，使用了 </span><code>else if</code><span> 的語句閱讀起來比較清晰明瞭，不過實際上 </span><code>if ... else if ... else ...</code><span> 語句可以被轉換為等價的巢狀 </span><code>if ... else</code><span>，利用後者生成 SIL 指令是比較容易的方式，下面的例子是個很好的演示。</span></p><center>Sprite C 條件判斷範例</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> ( <span class="cm-operator">!</span><span class="cm-variable">x</span> ) <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/* assume x and a are defined somewhere and also reachable */</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span> ( <span class="cm-variable">~x</span> ) <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 102px;"></div><div class="CodeMirror-gutters" style="display: none; height: 102px;"></div></div></div></pre><p>&nbsp;</p><center>前者的等價描述</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> ( <span class="cm-operator">!</span><span class="cm-variable">x</span> ) <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> ( <span class="cm-variable">~x</span> ) <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> &nbsp;<span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p>&nbsp;</p><center>條件判斷相應的 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">INV</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, x</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JIT</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, label1 &nbsp;<span class="cm-comment">; check !x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label1:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">a</span>, <span class="cm-comment">#1 &nbsp; &nbsp; &nbsp; ; a = 1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label2:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOT</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, x</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JIT</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, label4 &nbsp;<span class="cm-comment">; check ~x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label4:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">a</span>, <span class="cm-comment">#2 &nbsp; &nbsp; &nbsp; ; a = 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label5:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">a</span>, <span class="cm-comment">#3 &nbsp; &nbsp; &nbsp; ; a = 3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label3:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; empty statement</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 461px;"></div><div class="CodeMirror-gutters" style="display: none; height: 461px;"></div></div></div></pre><p>&nbsp;</p><h3 id='423迴圈'><span>4.2.3　迴圈</span></h3><p><span>　　考慮 </span><code>while (cond) { stmts }</code><span> 與 </span><code>for ( ; cond ; ) { stmts }</code><span> 是一樣的，所以說 </span><code>while</code><span> 迴圈可以改寫為使用 </span><code>for</code><span> 的等價描述，因此討論 </span><code>for</code><span> 迴圈即可。下面的範例迴圈實際上可以被編譯器優化掉，不產生任何的 SIL 指令。</span></p><center>Sprite C 迴圈範例</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">x</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">y</span>; <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">x</span><span class="cm-operator">+</span><span class="cm-number">1</span>) { <span class="cm-comment">/* assume y is defined somewhere */</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 102px;"></div><div class="CodeMirror-gutters" style="display: none; height: 102px;"></div></div></div></pre><p>&nbsp;</p><center>迴圈的相應 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, <span class="cm-comment">#0 &nbsp; &nbsp; &nbsp; ; int x = 0</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label1:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LT</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, x, y</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JIT</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, label2 &nbsp;<span class="cm-comment">; check x &lt; y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label2:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; empty statement</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, x, t2 &nbsp; <span class="cm-comment">; x+1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, t3 &nbsp; &nbsp; &nbsp; <span class="cm-comment">; x = x+1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label3:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; empty statement</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 333px;"></div><div class="CodeMirror-gutters" style="display: none; height: 333px;"></div></div></div></pre><p>&nbsp;</p><h3 id='423函數呼叫'><span>4.2.3　函數呼叫</span></h3><p><span>　　說到 Sprite C 就不能不提函數，函數的參數傳遞在翻譯成組合語言時，必須要符合目標機器的呼叫慣例，但我們不希望在 SIL 透露出機器相關的細節，為了使 SIL 是機器無關的語言，以下範例展示 SIL 的函數相關指令如何解決這個問題。通常來說 Sprite C 僅支援單一變數回傳，但 SIL 允許多變數的回傳，不過這不是個問題，因為既然 SIL 允許多變數的回傳，那自然也支援單一變數的回傳。</span></p><center>Sprite C 程式範例</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">add</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">y</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span> <span class="cm-operator">+</span> <span class="cm-variable">y</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">add</span>(<span class="cm-number">1</span>, <span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 205px;"></div><div class="CodeMirror-gutters" style="display: none; height: 205px;"></div></div></div></pre><p>&nbsp;</p><center>程式的相應 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">t1</span>, <span class="cm-comment">#1 &nbsp;  ; set t1 as the 1st argument to be passed into add</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">t2</span>, <span class="cm-comment">#2 &nbsp;  ; set t2 as the 2nd argument to be passed into add</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">CALL</span> &nbsp; &nbsp;<span class="cm-keyword">add</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment">; add(1, 2)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETRET</span> &nbsp;<span class="cm-keyword">t3</span>, <span class="cm-comment">#1 &nbsp;  ; get the 1st return value of add</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, t3 &nbsp; &nbsp; <span class="cm-comment">; int x = add(1, 2)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t4</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">t4</span>, <span class="cm-comment">#1 &nbsp;  ; set 0 as the 1st return value of main</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">add:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#1 &nbsp; &nbsp; ; x is the 1st passed in argument</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#2 &nbsp; &nbsp; ; y is the 2nd passed in argument</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, x, y &nbsp;<span class="cm-comment">; x + y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">t1</span>, <span class="cm-comment">#1 &nbsp;  ; set t1 as the 1st return value of add</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 435px;"></div><div class="CodeMirror-gutters" style="display: none; height: 435px;"></div></div></div></pre><p>&nbsp;</p><h3 id='424陣列'><span>4.2.4　陣列</span></h3><p><span>　　在目前的 Sprite C 中尚未支援靜態陣列宣告，但是可以透過 </span><code>malloc</code><span> 函數獲得動態的記憶體空間，再自行模擬出陣列，假設 </span><code>char</code><span> 的大小為八位元。</span></p><center>Sprite C 陣列範例</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">char*</span> <span class="cm-variable">arr</span> <span class="cm-operator">=</span> <span class="cm-variable">malloc</span>(<span class="cm-number">4</span><span class="cm-operator">*</span><span class="cm-number">1</span>); &nbsp;<span class="cm-comment">/* 4 elements in total, each element occupies 1 byte */</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">arr</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-string">'a'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">arr</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-string">'r'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">arr</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-string">'r'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">arr</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-string">'\0'</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 128px;"></div><div class="CodeMirror-gutters" style="display: none; height: 128px;"></div></div></div></pre><p>&nbsp;</p><center>陣列的相應 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, <span class="cm-comment">#4</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, t1, t2 &nbsp; &nbsp; <span class="cm-comment">; 4*1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">t3</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">CALL</span> &nbsp; &nbsp;<span class="cm-keyword">malloc</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; malloc(4*1)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETRET</span> &nbsp;<span class="cm-keyword">arr</span>, <span class="cm-comment">#1 &nbsp; &nbsp; &nbsp;  ; arr = malloc(4*1)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">size</span>, <span class="cm-comment">#1 &nbsp; &nbsp; &nbsp; ; the size of an element of arr, which is 1 byte</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t4</span>, <span class="cm-comment">#97 &nbsp; &nbsp; &nbsp;  ; ascii(97) is 'a'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t5</span>, <span class="cm-comment">#0</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t6</span>, t5, size &nbsp; <span class="cm-comment">; the real offset of arr[0]</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STB</span> &nbsp; &nbsp; <span class="cm-keyword">ch1</span>, arr, t6 &nbsp; <span class="cm-comment">; arr[0] = 'a'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t7</span>, <span class="cm-comment">#114 &nbsp; &nbsp; &nbsp; ; ascii(114) is 'r'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t8</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t9</span>, t8, size &nbsp; <span class="cm-comment">; the real offset of arr[1]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STB</span> &nbsp; &nbsp; <span class="cm-keyword">ch1</span>, arr, t9 &nbsp; <span class="cm-comment">; arr[1] = 'r'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t10</span>, <span class="cm-comment">#114 &nbsp; &nbsp;  ; ascii(114) is 'r'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t11</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t12</span>, t11, size <span class="cm-comment">; the real offset of arr[2]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STB</span> &nbsp; &nbsp; <span class="cm-keyword">ch1</span>, arr, t12 &nbsp;<span class="cm-comment">; arr[2] = 'r'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t13</span>, <span class="cm-comment">#0 &nbsp; &nbsp; &nbsp;  ; ascii(0) is '\0'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t14</span>, <span class="cm-comment">#3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t15</span>, t14, size <span class="cm-comment">; the real offset of arr[3]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STB</span> &nbsp; &nbsp; <span class="cm-keyword">ch1</span>, arr, t15 &nbsp;<span class="cm-comment">; arr[3] = '\0'</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 691px;"></div><div class="CodeMirror-gutters" style="display: none; height: 691px;"></div></div></div></pre><p>&nbsp;</p><h3 id='425結構體'><span>4.2.5　結構體</span></h3><p><span>　　Sprite C 中允許使用者自定義結構體，並將結構體作為參數傳遞，以下範例展示 Sprite C 結構體翻譯至 SIL 指令的可能情況。需要提醒的是範例只考慮 Sprite C 翻譯至 SIL，並未考慮 SIL 翻譯至目標機器會不會出現問題，會有此疑慮的原因是結構體的表達方式會依目標機器的 ABI 規定和編譯器的實現方式而有所不同。</span></p><center>Sprite C 結構體範例</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">struct</span> <span class="cm-def">Square</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">length</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">width</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">area</span>(<span class="cm-keyword">struct</span> <span class="cm-def">Square</span><span class="cm-operator">*</span> <span class="cm-variable">s</span>) { &nbsp; &nbsp; &nbsp;<span class="cm-comment">/* note that area takes a pointer of struct Square */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">s</span><span class="cm-operator">-&gt;</span><span class="cm-variable">length</span> <span class="cm-operator">*</span> <span class="cm-variable">s</span><span class="cm-operator">-&gt;</span><span class="cm-variable">width</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">struct</span> <span class="cm-def">Square</span> <span class="cm-def">s</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s</span>.<span class="cm-variable">length</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s</span>.<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-variable">area</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 410px;"></div><div class="CodeMirror-gutters" style="display: none; height: 410px;"></div></div></div></pre><p>&nbsp;</p><center>結構體的相應 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">len</span>, <span class="cm-comment">#5  ; s.length = 5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">wid</span>, <span class="cm-comment">#8  ; s.width = 8</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">len</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">wid</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">CALL</span> &nbsp; &nbsp;<span class="cm-keyword">area</span> &nbsp; &nbsp; <span class="cm-comment">; the behavior of area in SIL is in fact area(int, int) in Sprite C</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETRET</span> &nbsp;<span class="cm-keyword">t1</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">a</span>, t1 &nbsp; &nbsp;<span class="cm-comment">; a = area(s.length, s.width)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">t2</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">area:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">len</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">wid</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, len, wid</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">t1</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 435px;"></div><div class="CodeMirror-gutters" style="display: none; height: 435px;"></div></div></div></pre><p>&nbsp;</p><p><span>　　上面的 SIL 碼行為在這個例子上是正確的，也容易發現轉換到機器語言不會有太多困難，但這樣的翻譯方式會使編譯器需要仔細分析高階語言的行為，使實作上的複雜度升高。以下是使用到假想指令重新翻譯過的 SIL 指令，僅供參考。</span></p><center>結構體的相應 SIL 翻譯（使用假想指令）</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ALLO</span> &nbsp; &nbsp;<span class="cm-keyword">s</span>, <span class="cm-comment">#8 &nbsp; &nbsp;  ; allocate 8 bytes somewhere, and store the start address in s</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, <span class="cm-comment">#5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#0 &nbsp; &nbsp; ; offset for s.length</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STW</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, s, t2 &nbsp;<span class="cm-comment">; s.length = 5 (mem[s+0] = 5)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, <span class="cm-comment">#8</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t4</span>, <span class="cm-comment">#4 &nbsp; &nbsp; ; offset for s.width</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STW</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, s, t4 &nbsp;<span class="cm-comment">; s.width = 8  (mem[s+4] = 8)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">s</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">CALL</span> &nbsp; &nbsp;<span class="cm-keyword">area</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment">; area(&amp;s)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETRET</span> &nbsp;<span class="cm-keyword">t5</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">a</span>, t5 &nbsp; &nbsp; &nbsp;<span class="cm-comment">; a = area(&amp;s)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">DEALLO</span> &nbsp;<span class="cm-keyword">s</span>, <span class="cm-comment">#8 &nbsp; &nbsp;  ; s has reached the end of its lifetime, deallocate it</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">t2</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">area:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">s</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LDW</span> &nbsp; &nbsp; <span class="cm-keyword">l</span>, s, t1 &nbsp; <span class="cm-comment">; retrieve s-&gt;length</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LDW</span> &nbsp; &nbsp; <span class="cm-keyword">w</span>, s, t2 &nbsp; <span class="cm-comment">; retrieve s-&gt;width</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, l, w &nbsp; <span class="cm-comment">; s-&gt;length * s-&gt;width</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">t3</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 614px;"></div><div class="CodeMirror-gutters" style="display: none; height: 614px;"></div></div></div></pre><p>&nbsp;</p><h3 id='426位址運算元'><span>4.2.6　位址運算元</span></h3><p><span>　　敏銳一點的讀者可能會發現位址運算元 </span><code>&amp;</code><span> 在 SIL 中沒有對應指令，必須要經過編譯器分析程式碼的行為後，處理掉位址運算元。在變數交換的兩種翻譯中，對比參照後可以發現假想指令 </span><code>ALLO</code><span> 和 </span><code>DEALLO</code><span> 在翻譯上較為方便，另外注意到 SIL 翻譯中使用到了多變數回傳的特性。</span></p><center>Sprite C 中的變數交換</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">swap</span>(<span class="cm-variable-3">int*</span> <span class="cm-variable">x</span>, <span class="cm-variable-3">int*</span> <span class="cm-variable">y</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">temp</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">x</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">y</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">temp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">driver</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">swap</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">x</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">y</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 282px;"></div><div class="CodeMirror-gutters" style="display: none; height: 282px;"></div></div></div></pre><p>&nbsp;</p><center>變數交換的相應 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">swap:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">temp</span>, x &nbsp;<span class="cm-comment">; temp = x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, y &nbsp; &nbsp; <span class="cm-comment">; x = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">y</span>, temp &nbsp;<span class="cm-comment">; y = temp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETRET</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">driver:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, <span class="cm-comment">#10 &nbsp; ; x = 10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">y</span>, <span class="cm-comment">#20 &nbsp; ; y = 20</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">CALL</span> &nbsp; &nbsp;<span class="cm-keyword">swap</span> &nbsp; &nbsp; <span class="cm-comment">; swap(x, y)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETRET</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#1 &nbsp;  ; x is now overwritten with 20</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETRET</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#2 &nbsp;  ; y is now overwritten with 10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 461px;"></div><div class="CodeMirror-gutters" style="display: none; height: 461px;"></div></div></div></pre><p>&nbsp;</p><center>變數交換的相應 SIL 翻譯（使用假想指令）</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">swap:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">GETARG</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LDW</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, x, t1 &nbsp; &nbsp;<span class="cm-comment">; *x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LDW</span> &nbsp; &nbsp; <span class="cm-keyword">t4</span>, y, t3 &nbsp; &nbsp;<span class="cm-comment">; *y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MOV</span> &nbsp; &nbsp; <span class="cm-keyword">temp</span>, t2 &nbsp; &nbsp; <span class="cm-comment">; temp = *x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t5</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STW</span> &nbsp; &nbsp; <span class="cm-keyword">t4</span>, x, t5 &nbsp; &nbsp;<span class="cm-comment">; *x = *y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t6</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STW</span> &nbsp; &nbsp; <span class="cm-keyword">temp</span>, y, t6 &nbsp;<span class="cm-comment">; *y = temp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">driver:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ALLO</span> &nbsp; &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#4 &nbsp; &nbsp; &nbsp;  ; allocate 4 bytes somewhere, and store the start address in x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ALLO</span> &nbsp; &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#4 &nbsp; &nbsp; &nbsp;  ; allocate 4 bytes somewhere, and store the start address in y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, <span class="cm-comment">#10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STW</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, x, t2 &nbsp; &nbsp;<span class="cm-comment">; x = 10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, <span class="cm-comment">#20</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">t4</span>, <span class="cm-comment">#0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">STW</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, y, t4 &nbsp; &nbsp;<span class="cm-comment">; y = 20</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SETARG</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">CALL</span> &nbsp; &nbsp;<span class="cm-keyword">swap</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; swap(&amp;x, &amp;y)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">DEALLO</span> &nbsp;<span class="cm-keyword">x</span>, <span class="cm-comment">#4 &nbsp; &nbsp; &nbsp;  ; x has reached the end of its lifetime, deallocate it</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">DEALLO</span> &nbsp;<span class="cm-keyword">y</span>, <span class="cm-comment">#4 &nbsp; &nbsp; &nbsp;  ; y has reached the end of its lifetime, deallocate it</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 717px;"></div><div class="CodeMirror-gutters" style="display: none; height: 717px;"></div></div></div></pre><p>&nbsp;</p><h2 id='43與-rv32i-組合語言之對應'><span>4.3　與 RV32I 組合語言之對應</span></h2><p><span>　　SIL 的指令與 RV32I 的指令並非都能建立直接的對應關係，沒辦法直接對應的指令在下面的子標題分別討論之。</span></p><center>表 4.1：SIL 與 RV32I 組合語言之對應</center><figure><table><thead><tr><th><span>SIL Instruction Set</span></th><th><span>RV32I Assembly Language</span></th></tr></thead><tbody><tr><td><code>IMM x, #immediate</code></td><td><code>LI x, immediate</code></td></tr><tr><td><code>MOV x, y</code></td><td><code>MV x, y</code></td></tr><tr><td><code>NOP</code></td><td><code>NOP</code></td></tr><tr><td><code>ADD x, y, z</code></td><td><code>ADD x, y, z</code></td></tr><tr><td><code>SUB x, y, z</code></td><td><code>SUB x, y, z</code></td></tr><tr><td><code>MUL x, y, z</code></td><td><span>RV32I 組合語言中不存在乘法指令</span></td></tr><tr><td><code>DIV x, y, z</code></td><td><span>RV32I 組合語言中不存在除法指令</span></td></tr><tr><td><code>MOD x, y, z</code></td><td><span>RV32I 組合語言中不存在餘數指令</span></td></tr><tr><td><code>AND x, y, z</code></td><td><code>AND x, y, z</code></td></tr><tr><td><code>OR x, y, z</code></td><td><code>OR x, y, z</code></td></tr><tr><td><code>NOT x, y</code></td><td><code>NOT x, y</code></td></tr><tr><td><code>XOR x, y, z</code></td><td><code>XOR x, y, z</code></td></tr><tr><td><code>SHL x, y, z</code></td><td><code>SLL x, y, z</code></td></tr><tr><td><code>SHR x, y, z</code></td><td><code>SRA x, y, z</code></td></tr><tr><td><code>EQ x, y, z</code></td><td><code>XOR x, y, z</code><br><code>SEQZ x, x</code></td></tr><tr><td><code>NE x, y, z</code></td><td><code>XOR x, y, z</code><br><code>SNEZ x, x</code></td></tr><tr><td><code>LE x, y, z</code></td><td><code>SLT x, z, y</code><br><code>XORI x, x, 1</code></td></tr><tr><td><code>LT x, y, z</code></td><td><code>SLT x, y, z</code></td></tr><tr><td><code>GE x, y, z</code></td><td><code>SLT x, y, z</code><br><code>XORI x, x, 1</code></td></tr><tr><td><code>GT x, y, z</code></td><td><code>SLT x, z, y</code></td></tr><tr><td><code>INV x, y</code></td><td><code>NEG x, y</code></td></tr><tr><td><code>LDB x, y, z</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>LDBU x, y, z</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>STB x, y, z</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>LDW x, y, z</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>LDWU x, y, z</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>STW x, y, z</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>LLA x, label</code></td><td><code>LLA x, symbol</code></td></tr><tr><td><code>JMP label</code></td><td><code>J offset</code></td></tr><tr><td><code>JIT x, label</code></td><td><code>BNE rd, zero, offset</code></td></tr><tr><td><code>CALL function</code></td><td><code>CALL offset</code></td></tr><tr><td><code>RET</code></td><td><code>RET</code></td></tr><tr><td><code>SETARG x, #index</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>GETARG x, #index</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>SETRET x, #index</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr><tr><td><code>GETRET x, #index</code></td><td><span>RISC-V 組合語言中不存在直接對應</span></td></tr></tbody></table></figure><p>&nbsp;</p><h3 id='431乘法除法和餘數指令的替代方案'><span>4.3.1　乘法、除法和餘數指令的替代方案</span></h3><p><span>　　乘法 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.272ex" height="1.684ex" viewBox="0 -602.8 2700.4 724.9" role="img" focusable="false" style="vertical-align: -0.284ex;"><defs><path stroke-width="0" id="E11-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E11-MJMAIN-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path stroke-width="0" id="E11-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-6E" x="0" y="0"></use><use xlink:href="#E11-MJMAIN-D7" x="822" y="0"></use><use xlink:href="#E11-MJMATHI-6D" x="1822" y="0"></use></g></svg></span><script type="math/tex">n \times m</script><span> 本質上是 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.394ex" height="1.544ex" viewBox="0 -542.7 600 664.9" role="img" focusable="false" style="vertical-align: -0.284ex;"><defs><path stroke-width="0" id="E12-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E12-MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex">n</script><span> 自身連加 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.039ex" height="1.544ex" viewBox="0 -542.7 878 664.9" role="img" focusable="false" style="vertical-align: -0.284ex;"><defs><path stroke-width="0" id="E13-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E13-MJMATHI-6D" x="0" y="0"></use></g></svg></span><script type="math/tex">m</script><span> 次的和，因此雖然 RV32I 中沒有對應的指令，但是可以用加法和迴圈來取代這條指令，除法和餘數的處理方法也差不多，由於目前的組合語言翻譯只使用單純的迴圈，Sprite C 和 SIL 的使用者如果對運算速度、溢位檢測有所要求，應自行編寫相應的程式碼，避免編譯器翻譯出 </span><code>MUL</code><span>、</span><code>DIV</code><span> 和 </span><code>MOD</code><span> 等 SIL 指令。</span></p><p>&nbsp;</p><h4 id='4311乘法'><span>4.3.1.1　乘法</span></h4><p><span>　　假設欲翻譯的乘法指令為 </span><code>MUL x, y, z</code><span>，以下翻譯經過簡單優化，利用乘法的可交換性，使得被連加的對象為 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.178ex" height="2.8ex" viewBox="0 -843.1 5673.7 1205.5" role="img" focusable="false" style="vertical-align: -0.842ex;"><defs><path stroke-width="0" id="E14-MJMAIN-6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path stroke-width="0" id="E14-MJMAIN-61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z"></path><path stroke-width="0" id="E14-MJMAIN-78" d="M201 0Q189 3 102 3Q26 3 17 0H11V46H25Q48 47 67 52T96 61T121 78T139 96T160 122T180 150L226 210L168 288Q159 301 149 315T133 336T122 351T113 363T107 370T100 376T94 379T88 381T80 383Q74 383 44 385H16V431H23Q59 429 126 429Q219 429 229 431H237V385Q201 381 201 369Q201 367 211 353T239 315T268 274L272 270L297 304Q329 345 329 358Q329 364 327 369T322 376T317 380T310 384L307 385H302V431H309Q324 428 408 428Q487 428 493 431H499V385H492Q443 385 411 368Q394 360 377 341T312 257L296 236L358 151Q424 61 429 57T446 50Q464 46 499 46H516V0H510H502Q494 1 482 1T457 2T432 2T414 3Q403 3 377 3T327 1L304 0H295V46H298Q309 46 320 51T331 63Q331 65 291 120L250 175Q249 174 219 133T185 88Q181 83 181 74Q181 63 188 55T206 46Q208 46 208 23V0H201Z"></path><path stroke-width="0" id="E14-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E14-MJMAIN-7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path><path stroke-width="0" id="E14-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E14-MJMAIN-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path stroke-width="0" id="E14-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E14-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E14-MJMAIN-6D"></use><use xlink:href="#E14-MJMAIN-61" x="833" y="0"></use><use xlink:href="#E14-MJMAIN-78" x="1333" y="0"></use><use xlink:href="#E14-MJMAIN-28" x="1861" y="0"></use><use xlink:href="#E14-MJMAIN-7C" x="2250" y="0"></use><use xlink:href="#E14-MJMATHI-6E" x="2528" y="0"></use><use xlink:href="#E14-MJMAIN-7C" x="3128" y="0"></use><use xlink:href="#E14-MJMAIN-2C" x="3406" y="0"></use><use xlink:href="#E14-MJMAIN-7C" x="3850" y="0"></use><use xlink:href="#E14-MJMATHI-6D" x="4128" y="0"></use><use xlink:href="#E14-MJMAIN-7C" x="5006" y="0"></use><use xlink:href="#E14-MJMAIN-29" x="5284" y="0"></use></g></svg></span><script type="math/tex">\max(|n|, |m|)</script><span>，迴圈的執行次數為 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.727ex" height="2.8ex" viewBox="0 -843.1 5479.7 1205.5" role="img" focusable="false" style="vertical-align: -0.842ex;"><defs><path stroke-width="0" id="E15-MJMAIN-6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path stroke-width="0" id="E15-MJMAIN-69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"></path><path stroke-width="0" id="E15-MJMAIN-6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path stroke-width="0" id="E15-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E15-MJMAIN-7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path><path stroke-width="0" id="E15-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E15-MJMAIN-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path stroke-width="0" id="E15-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E15-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E15-MJMAIN-6D"></use><use xlink:href="#E15-MJMAIN-69" x="833" y="0"></use><use xlink:href="#E15-MJMAIN-6E" x="1111" y="0"></use><use xlink:href="#E15-MJMAIN-28" x="1667" y="0"></use><use xlink:href="#E15-MJMAIN-7C" x="2056" y="0"></use><use xlink:href="#E15-MJMATHI-6E" x="2334" y="0"></use><use xlink:href="#E15-MJMAIN-7C" x="2934" y="0"></use><use xlink:href="#E15-MJMAIN-2C" x="3212" y="0"></use><use xlink:href="#E15-MJMAIN-7C" x="3656" y="0"></use><use xlink:href="#E15-MJMATHI-6D" x="3934" y="0"></use><use xlink:href="#E15-MJMAIN-7C" x="4812" y="0"></use><use xlink:href="#E15-MJMAIN-29" x="5090" y="0"></use></g></svg></span><script type="math/tex">\min(|n|, |m|)</script><span>，雖然理論上的時間複雜度沒變，依舊是 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.973ex" height="2.8ex" viewBox="0 -843.1 2141 1205.5" role="img" focusable="false" style="vertical-align: -0.842ex;"><defs><path stroke-width="0" id="E16-MJMATHI-4F" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path stroke-width="0" id="E16-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E16-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E16-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E16-MJMATHI-4F" x="0" y="0"></use><use xlink:href="#E16-MJMAIN-28" x="763" y="0"></use><use xlink:href="#E16-MJMATHI-6E" x="1152" y="0"></use><use xlink:href="#E16-MJMAIN-29" x="1752" y="0"></use></g></svg></span><script type="math/tex">O(n)</script><span>，但整體來說可以降低運算時間。</span></p><center>乘法指令的 RV32I 替代方案</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s0 = x</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s1 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s2 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">s0</span>, zero, 0 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># x = 0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, -16 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># allocate 16 byte on the stack</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># preserve t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, s1, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t0 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, s2, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t1 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t2</span>, s1, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t2 = sign(y)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t3</span>, s2, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t3 = sign(z)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, zero, t0 &nbsp; &nbsp; <span class="cm-comment"># t0 = |y|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, zero, t1 &nbsp; &nbsp; <span class="cm-comment"># t1 = |z|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">XOR</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, t2, t3 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t2 = sign correction flag</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BGE</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, t1, 16 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t0 = max(|y|, |z|), t1 = min(|y|, |z|)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t3</span>, t0, 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, t1, 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, t3, 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, zero, 16 &nbsp; &nbsp; <span class="cm-comment"># calculate |y| * |z| in this loop</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, s0, t0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, t1, -1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">zero</span>, zero, -12</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># perform sign correction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, zero, s0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># restore t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, 16 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># deallocate 16 byte on the stack</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 845px;"></div><div class="CodeMirror-gutters" style="display: none; height: 845px;"></div></div></div></pre><p>&nbsp;</p><h4 id='4312除法'><span>4.3.1.2　除法</span></h4><p><span>　　假設欲翻譯的除法指令為 </span><code>DIV x, y, z</code><span>，則下述未優化翻譯的時間複雜度為 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.857ex" height="2.94ex" viewBox="0 -843.1 2521.8 1265.6" role="img" focusable="false" style="vertical-align: -0.981ex;"><defs><path stroke-width="0" id="E18-MJMATHI-4F" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path stroke-width="0" id="E18-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E18-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E18-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E18-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E18-MJMATHI-4F" x="0" y="0"></use><use xlink:href="#E18-MJMAIN-28" x="763" y="0"></use><g transform="translate(1152,0)"><g transform="translate(120,0)"><rect stroke="none" width="740" height="60" x="0" y="220"></rect><use transform="scale(0.707)" xlink:href="#E18-MJMATHI-6E" x="223" y="608"></use><use transform="scale(0.707)" xlink:href="#E18-MJMATHI-6D" x="84" y="-488"></use></g></g><use xlink:href="#E18-MJMAIN-29" x="2132" y="0"></use></g></svg></span><script type="math/tex">O(\frac{n}{m})</script><span>。</span></p><center>除法指令的 RV32I 替代方案</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s0 = x</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s1 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s2 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">s0</span>, zero, 0 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># x = 0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, -16 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># allocate 16 byte on the stack</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># preserve t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, s1, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t0 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, s2, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t1 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t2</span>, s1, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t2 = sign(y)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t3</span>, s2, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t3 = sign(z)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, zero, t0 &nbsp; &nbsp; <span class="cm-comment"># t0 = |y|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, zero, t1 &nbsp; &nbsp; <span class="cm-comment"># t1 = |z|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">XOR</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, t2, t3 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t2 = sign correction flag</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BLT</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, t1, 16 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># calculate |y| / |z| in this loop</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, t0, t1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">s0</span>, s0, 1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">zero</span>, zero, -12</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># perform sign correction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, zero, s0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># restore t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, 16 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># deallocate 16 byte on the stack</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 742px;"></div><div class="CodeMirror-gutters" style="display: none; height: 742px;"></div></div></div></pre><p>&nbsp;</p><h4 id='4313餘數'><span>4.3.1.3　餘數</span></h4><p><span>　　假設欲翻譯的餘數指令為 </span><code>MOD x, y, z</code><span>，以下翻譯與除法類似，時間複雜度也同樣為 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.857ex" height="2.94ex" viewBox="0 -843.1 2521.8 1265.6" role="img" focusable="false" style="vertical-align: -0.981ex;"><defs><path stroke-width="0" id="E18-MJMATHI-4F" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path stroke-width="0" id="E18-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E18-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E18-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E18-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E18-MJMATHI-4F" x="0" y="0"></use><use xlink:href="#E18-MJMAIN-28" x="763" y="0"></use><g transform="translate(1152,0)"><g transform="translate(120,0)"><rect stroke="none" width="740" height="60" x="0" y="220"></rect><use transform="scale(0.707)" xlink:href="#E18-MJMATHI-6E" x="223" y="608"></use><use transform="scale(0.707)" xlink:href="#E18-MJMATHI-6D" x="84" y="-488"></use></g></g><use xlink:href="#E18-MJMAIN-29" x="2132" y="0"></use></g></svg></span><script type="math/tex">O(\frac{n}{m})</script><span>。</span></p><center>餘數指令的 RV32I 替代方案</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s0 = x</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s1 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s2 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, -16 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># allocate 16 byte on the stack</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># preserve t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, s1, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t0 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, s2, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t1 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t2</span>, s1, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t2 = sign(y)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t3</span>, s2, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t3 = sign(z)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, zero, t0 &nbsp; &nbsp; <span class="cm-comment"># t0 = |y|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, zero, t1 &nbsp; &nbsp; <span class="cm-comment"># t1 = |z|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BLT</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, t1, 12 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># calculate |y| % |z| in this loop</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, t0, t1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">zero</span>, zero, -8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">s0</span>, t0, 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># perform sign correction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, zero, s0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># restore t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, 16 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># deallocate 16 byte on the stack</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 691px;"></div><div class="CodeMirror-gutters" style="display: none; height: 691px;"></div></div></div></pre><p>&nbsp;</p><h4 id='4314編譯器處理建議'><span>4.3.1.4　編譯器處理建議</span></h4><p><span>　　在編譯器遇到 </span><code>MUL</code><span>、</span><code>DIV</code><span> 和 </span><code>MOD</code><span> 指令時，直接用替代的程式碼覆蓋掉原先的指令可能使暫存器的分配難度升高，一個較為合理的做法是將指令替代為函數呼叫，再透過被呼叫的函數完成所要的計算。以下用 </span><code>MUL</code><span> 指令做為範例，使用到的 </span><code>__mul32</code><span> 函數由上面給出的乘法替代方案修改而來，核心的計算方法沒有改變，由於使用函數執行乘法，乘法的處理和原本的程式區塊因而被分隔成兩個互不干擾的區塊，不須煩惱暫存器的分配問題，這種方法的除了需要跟記憶體互動，因而需要花費較多時間外，沒有什麼明顯的缺點。</span></p><p><span>　　需要注意的是，使用函數替代指令必須要確保函數呼叫前後，除了儲存計算結果的暫存器外，其餘暫存器的值都不變，這是因為使用者不需要也不可能感知到指令被替換成從未寫過的函數，所以任何對非儲存計算結果的暫存器的修改都可能導致使用者的程式發生錯誤。</span></p><center>Sprite C 乘法表達式</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">y</span> <span class="cm-operator">*</span> <span class="cm-variable">z</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="display: none; height: 77px;"></div></div></div></pre><p>&nbsp;</p><center>乘法表達式的相應 SIL 翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MUL</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, y, z</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="display: none; height: 77px;"></div></div></div></pre><p>&nbsp;</p><center>建議的處理方式</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s0 = x</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s1 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># s2 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, -12 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># allocate 12 byte on the stack</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve ra</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve a0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a1</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve a1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MV</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>, s1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MV</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a1</span>, s2</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">CALL</span> &nbsp; &nbsp;<span class="cm-builtin">__mul32</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># simulate the MUL instruction of SIL via __mul32</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">MV</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">s0</span>, a0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a1</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore a1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore a0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore ra</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, 12 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># deallocate 12 byte on the stack</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">__mul32</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, -16 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># allocate 16 byte on the stack</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># preserve t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># preserve t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, a0, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t0 = y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, a1, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># t1 = z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t2</span>, a0, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t2 = sign(y)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SRLI</span> &nbsp; &nbsp;<span class="cm-keyword">t3</span>, a1, 31 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t3 = sign(z)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">a0</span>, zero, 0 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># x = 0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, zero, t0 &nbsp; &nbsp; <span class="cm-comment"># t0 = |y|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t3</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, zero, t1 &nbsp; &nbsp; <span class="cm-comment"># t1 = |z|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">XOR</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, t2, t3 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t2 = sign correction flag</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BGE</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, t1, 16 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># t0 = max(|y|, |z|), t1 = min(|y|, |z|)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t3</span>, t0, 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, t1, 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, t3, 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, zero, 16 &nbsp; &nbsp; <span class="cm-comment"># calculate |y| * |z| in this loop</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">a0</span>, a0, t0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">t1</span>, t1, -1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">zero</span>, zero, -12</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">t2</span>, zero, 8 &nbsp; &nbsp; &nbsp;<span class="cm-comment"># perform sign correction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SUB</span> &nbsp; &nbsp; <span class="cm-keyword">a0</span>, zero, a0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t3</span>, 0(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t2</span>, 4(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t1</span>, 8(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># restore t1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, 12(<span class="cm-variable">sp</span>) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># restore t0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, 16 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># deallocate 16 byte on the stack</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">RET</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1254px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1254px;"></div></div></div></pre><p>&nbsp;</p><h3 id='432載入與儲存指令的對應'><span>4.3.2　載入與儲存指令的對應</span></h3><p><span>　　RV32I 的載入與儲存指令與 SIL 不同，使用兩個暫存器和一個立即值，因此指令並不存在直接的對應，實際上兩者的載入與儲存指令的格式各有優缺點，以下以載入單字（load word）演示可能的對應狀況，假設 </span><code>x</code><span>、</span><code>y</code><span> 和 </span><code>z</code><span> 分別儲存於 </span><code>rd</code><span>、</span><code>rs1</code><span> 和 </span><code>rs2</code><span>，</span><code>temp</code><span> 儲存於非</span><code>rd</code><span>、</span><code>rs1</code><span> 或 </span><code>rs2</code><span> 的暫存器。</span></p><center>表 4.2：RV32I 與 SIL 的載入與儲存指令對應方式</center><figure><table><thead><tr><th><span>Simple Intermediate Language</span></th><th><span>RV32I Assembly Language</span></th></tr></thead><tbody><tr><td><code>IMM z, #offset</code><br><code>LDW x, y, z</code></td><td><code>LW rd, offset(rs1)</code></td></tr><tr><td><code>IMM y, #offset</code><br><code>LDW x, y, z</code></td><td><code>LW rd, offset(rs2)</code></td></tr><tr><td><code>LDW x, y, z</code></td><td><code>ADD temp, y, z</code><br><code>LW x, 0(temp)</code></td></tr></tbody></table></figure><p>&nbsp;</p><p><span>　　由表 4.2 可以看出編譯器在由 Sprite C 翻譯為 SIL 時，盡量將 </span><code>IMM</code><span> 與 </span><code>LDB</code><span> </span><code>STB</code><span>、</span><code>LDW</code><span>、</span><code>STW</code><span> 等載入儲存指令排列在一起，能使編譯器更加容易將其翻譯為較為簡潔的 RV32I 指令，以下例子可以看出表 4.2 建議的方法比直接翻譯節約了兩條指令，相當於三倍的速度提升。</span></p><center>SIL 載入單字</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">IMM</span> &nbsp; &nbsp; <span class="cm-keyword">z</span>, <span class="cm-comment">#offset</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LDW</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, y, z</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 51px;"></div><div class="CodeMirror-gutters" style="display: none; height: 51px;"></div></div></div></pre><p>&nbsp;</p><center>直接翻譯的 RV32I 指令</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">rs2</span>, zero, offset &nbsp;<span class="cm-comment"># IMM &nbsp; &nbsp; z, #offset</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-keyword">temp</span>, rs1, rs2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">rd</span>, 0(temp)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="display: none; height: 77px;"></div></div></div></pre><p>&nbsp;</p><h3 id='433轉跳指令的對應'><span>4.3.3　轉跳指令的對應</span></h3><p><span>　　SIL 的轉跳指令與 RV32I 提供的轉跳指令差異較大，但處理的思路與表 4.2 相近。</span><code>EQ</code><span>、</span><code>NE</code><span>、</span><code>LE</code><span>、</span><code>LT</code><span>、</span><code>GE</code><span> 和 </span><code>GT</code><span> 格式相同，此處僅以 </span><code>EQ</code><span> 為例，其餘指令可用相同概念類推得到， 假設 </span><code>x</code><span>、</span><code>y</code><span> 和 </span><code>z</code><span> 分別儲存於 </span><code>rd</code><span>、</span><code>rs1</code><span> 和 </span><code>rs2</code><span>，</span><code>label</code><span> 的實際值為 </span><code>offset</code><span>。</span></p><center>表 4.3：RV32I 與 SIL 的轉跳指令對應方式</center><figure><table><thead><tr><th><span>Simple Intermediate Language</span></th><th><span>RV32I Assembly Language</span></th></tr></thead><tbody><tr><td><code>EQ x, y, z</code><br><code>JIT x, label</code></td><td><code>BEQ rs1, rs2, offset</code></td></tr><tr><td><code>INV x, y</code><br><code>JIT x, label</code></td><td><code>BEQ rs1, zero, offset</code></td></tr><tr><td><code>JIT x, label</code></td><td><code>BNE rd, zero, offset</code></td></tr></tbody></table></figure><p>&nbsp;</p><p><span>　　雖然 </span><code>EQ</code><span> 等指令已在表 4.1 給出等價的 RV32I 指令，但這些指令在高階語言中通常都與轉跳語句相搭配，因而可以縮減為一條 RV32I 的轉跳指令，比較下面的 RV32I 翻譯結果可見此處方法的優越性。</span></p><center>Sprite C 條件語句</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">y</span> <span class="cm-operator">==</span> <span class="cm-variable">z</span>) { &nbsp;<span class="cm-comment">/* assume x and y are defined somewhere and also reachable */</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 102px;"></div><div class="CodeMirror-gutters" style="display: none; height: 102px;"></div></div></div></pre><p>&nbsp;</p><center>SIL 的等價翻譯</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">EQ</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">x</span>, y, z</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JIT</span> &nbsp; &nbsp; <span class="cm-keyword">x</span>, label1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label1:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; the empty statement inside the if body</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">JMP</span> &nbsp; &nbsp; <span class="cm-keyword">label2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">label2:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">; the empty statement outside the if body</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 205px;"></div><div class="CodeMirror-gutters" style="display: none; height: 205px;"></div></div></div></pre><p>&nbsp;</p><center>直接與建議的 RV32I 翻譯結果</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">; direct translation</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">XOR</span> &nbsp; &nbsp; <span class="cm-keyword">rd</span>, rs1, rs2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">SEQZ</span> &nbsp; &nbsp;<span class="cm-keyword">rd</span>, rd</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BNE</span> &nbsp; &nbsp; <span class="cm-keyword">rd</span>, zero, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">J</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">12</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">; the empty statement inside the if body</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">J</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">; the empty statement outside the if body</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">; recommended translation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">BEQ</span> &nbsp; &nbsp; <span class="cm-keyword">rs1</span>, rs2, 8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">J</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">12</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">; the empty statement inside the if body</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">J</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">NOP</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">; the empty statement outside the if body</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p>&nbsp;</p><h3 id='434函數相關指令的對應'><span>4.3.4　函數相關指令的對應</span></h3><p><span>　　</span><code>SETARG</code><span>、</span><code>GETARG</code><span>、</span><code>SETRET</code><span> 和 </span><code>GETRET</code><span> 需要翻譯為遵守 RISC-V ELF psABI 行為的指令，傳遞參數時，ABI 規定優先使用由編號為 a0 開始直到編號為 a7 的參數暫存器，換言之當 </span><code>index</code><span> 之值不大於 8 時，以 8 為例，則 </span><code>SETARG var, #8</code><span> 和 </span><code>GETARG var, #8</code><span> 應該被分別翻譯為 </span><code>MV var, a7</code><span> 和 </span><code>MV var, a7</code><span>，如 </span><code>index</code><span> 之值超出 8 時，應以堆疊傳遞，至於該如何以堆疊傳遞 ABI 並未說明。回傳參數時，ABI 規定只能使用由 a0 和 a1 兩個暫存器，當 </span><code>index</code><span> 之值不大於 2 時，以 2 為例，則 </span><code>SETRET var, #2</code><span> 和 </span><code>GETRET var, #2</code><span> 應該被分別翻譯為 </span><code>MV a1, var</code><span> 和 </span><code>MV a1, var</code><span>，如 </span><code>index</code><span> 之值超出 2 時，ABI 並沒有指出相應的行為，建議遇到該情形，可以在傳遞參數時透過預先分配可用空間來供被呼叫的函式回傳參數。舉例來說，若 </span><code>SETRET</code><span> 的 </span><code>index</code><span> 為 3，則呼叫者可以在堆疊中分配 4 位元組的空間，當被呼叫者要設定回傳值時，將第三個不能放進 a0 和 a1 的回傳值放置在預先分配的空間中，達到回傳第三個回傳值的效果。</span></p><p><span>　　RISC-V ELF psABI 中規定了各式情況下的參數傳遞與回傳方式，例如超過 64 位元大小的結構體應事先分配空間，再以參照的概念將位址傳入函數，但此類規定是編譯器將 Sprite C 翻譯至 SIL 應該考慮的約束，而非 SIL 翻譯至 RV32I 指令要顧慮的問題，不過即便編譯器在翻譯到 SIL 時不遵守 ABI 的規定，只要確定翻譯的行為正確，按前面的文字說明，可以保證在 SIL 翻譯至 RV32I 時變得遵守 ABI 的規定，提供能夠接受的最終結果。</span></p><p>&nbsp;</p><h2 id='44程式生成之-sil-檔格式'><span>4.4　程式生成之 .sil 檔格式</span></h2><p><span>　　總體而言，程式由三大區塊構成，分別是函數區、符號表區和字串表區構成，構成的區塊尚未確定。</span></p><center>程式生成的 .sil 格式</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.function</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.symbol</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; ...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p>&nbsp;</p><h3 id='441函數區'><span>4.4.1　函數區</span></h3><p><span>　　函數區中儲存 Sprite C 原始碼檔案中所提及的自定義函數，若存在 </span><code>main</code><span> 函數，則 </span><code>main</code><span> 函數需要被放置在開頭。每個函數以其名為標籤開始，按順序存放指令，每行指令和標籤語法末尾需要跟隨一個換行字元。指令名稱的前面與後面各需要一個欄標字元（tab），變數與變數間以一個逗號和空白隔開，舉例來說 </span><code>ADD x, y, z</code><span> 在檔案中會是 </span><code>\tADD\tx, y, z\n</code><span>。</span></p><p>&nbsp;</p><h3 id='442符號表區'><span>4.4.2　符號表區</span></h3><p><span>　　符號表中每個符號需要紀錄其名稱和相關資訊，末尾跟隨一個換行字元，資訊與資訊間以欄標字元隔開。需要紀錄的資訊暫定為名稱、資料型態和作用域。</span></p><p>&nbsp;</p><h3 id='443字串表區'><span>4.4.3　字串表區</span></h3><p><span>　　字串表區中的每個字串由字串代稱和字串內容組成，字串代稱使用標籤語法，末尾跟隨一個換行字元，字串內容須以引號（&quot;）包圍，且開頭引號之前需要加上欄標字元，末尾引號之後跟隨一個換行字元。</span></p><p>&nbsp;</p><h3 id='444範例'><span>4.4.4　範例</span></h3><p><span>　　example.sc 為簡單的 Sprite C 原始碼檔案，經過處理後，合法的程式生成 .sil 檔內容如 example.sil 所示。</span></p><center> example.sc 的內容</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">add</span>(<span class="cm-variable-3">int</span>, <span class="cm-variable-3">int</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">80</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">b</span> <span class="cm-operator">=</span> <span class="cm-number">7</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">c</span> <span class="cm-operator">=</span> <span class="cm-variable">add</span>(<span class="cm-variable">a</span>, <span class="cm-variable">b</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"%d + %d = %d"</span>, <span class="cm-variable">a</span>, <span class="cm-variable">b</span>, <span class="cm-variable">c</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">add</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">a</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">b</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">a</span> <span class="cm-operator">+</span> <span class="cm-variable">b</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 333px;"></div><div class="CodeMirror-gutters" style="display: none; height: 333px;"></div></div></div></pre><p>&nbsp;</p><center>example.sil 的內容，設欄標字元為八空白字元長</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.function</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">main:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  IMM &nbsp; &nbsp; a, #80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  IMM &nbsp; &nbsp; b, #7</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETARG  a, #1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETARG  b, #2</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  CALL &nbsp;  add</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  GETRET  c, #1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  LLA &nbsp; &nbsp; _t1, _str1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETARG  _t1, #1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETARG  a, #2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETARG  b, #3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETARG  c, #4</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  CALL &nbsp;  printf</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  IMM &nbsp; &nbsp; _t2, #0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETRET  _t2, #1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RET</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">add:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  GETARG  a, #1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  GETARG  b, #2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ADD &nbsp; &nbsp; _t3, a, b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  SETRET  _t3, #1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RET</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.symbol</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">main &nbsp;  func &nbsp;  global</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">add &nbsp; &nbsp; func &nbsp;  global</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">a &nbsp; &nbsp; &nbsp; int32 &nbsp; main</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">b &nbsp; &nbsp; &nbsp; int32 &nbsp; main</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">c &nbsp; &nbsp; &nbsp; int32 &nbsp; main</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">_t1 &nbsp; &nbsp; ptr32 &nbsp; main</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">_t2 &nbsp; &nbsp; int32 &nbsp; main</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">a &nbsp; &nbsp; &nbsp; int32 &nbsp; add</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">b &nbsp; &nbsp; &nbsp; int32 &nbsp; add</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">_t3 &nbsp; &nbsp; int32 &nbsp; add</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">_str1:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "%d + %d = %d\n\0"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 973px;"></div><div class="CodeMirror-gutters" style="display: none; height: 973px;"></div></div></div></pre><p>&nbsp;</p><h2 id='45未來規劃'><span>4.5　未來規劃</span></h2><ul><li><span>以位元運算改寫乘法、除法和餘數指令的翻譯</span></li><li><span>增加對無號數的支援</span></li><li><span>增加人類編寫的 .sil 檔格式規定</span></li><li><span>隨 Sprite C 和支援的指令集的增加，擴充需要的指令</span></li></ul><p>&nbsp;</p><h2 id='參考資料-2'><span>參考資料</span></h2><ol start='' ><li><span>“Intermediate Representation (IR) for AMaCC Compilation”, HY Chang and Jim Huang, March 2019. </span><a href='https://github.com/jserv/amacc/blob/master/docs/IR.md' target='_blank' class='url'>https://github.com/jserv/amacc/blob/master/docs/IR.md</a><span>.</span></li><li><span>“The source code of 9cc C compiler”, Rui Ueyama, November 2019. </span><a href='https://github.com/rui314/9cc/blob/master/9cc.h' target='_blank' class='url'>https://github.com/rui314/9cc/blob/master/9cc.h</a><span>.</span></li><li><span>“Common Language Infrastructure (CLI) Partition III: CIL Instruction set”, Ecma International, 2012. </span><a href='https://www.ecma-international.org/wp-content/uploads/ECMA-335_6th_edition_june_2012.pdf' target='_blank' class='url'>https://www.ecma-international.org/wp-content/uploads/ECMA-335_6th_edition_june_2012.pdf</a><span>.</span></li><li><span>“GIMPLE instruction set”, The GCC team, Free Software Foundation, Inc, 2021. </span><a href='https://gcc.gnu.org/onlinedocs/gccint/GIMPLE-instruction-set.html#GIMPLE-instruction-set' target='_blank' class='url'>https://gcc.gnu.org/onlinedocs/gccint/GIMPLE-instruction-set.html#GIMPLE-instruction-set</a><span>.</span></li><li><span>“More RISC-V Instruction and How to Implement Functions”, Krste Asanovićand Randy H. Katz, CS61C, UC Berkeley, September 2017. </span><a href='https://inst.eecs.berkeley.edu/~cs61c/fa17/lec/06/L06%20RISCV%20Functions%20(1up).pdf' target='_blank' class='url'>https://inst.eecs.berkeley.edu/~cs61c/fa17/lec/06/L06%20RISCV%20Functions%20(1up).pdf</a></li><li><span>“RISC-V ELF psABI specification”, Palmer Dabbelt, Stefan O&#39;Rear, Kito Cheng, Andrew Waterman, Michael Clark, Alex Bradbury, David Horner, Max Nordlund, and Karsten Merker, Sam Elliott, 2019. </span><a href='https://github.com/riscv/riscv-elf-psabi-doc/blob/master/riscv-elf.md' target='_blank' class='url'>https://github.com/riscv/riscv-elf-psabi-doc/blob/master/riscv-elf.md</a><span>.</span></li></ol><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-5rv32i'><span>Chapter 5　RV32I</span></h1><hr /><left>作者：陳忠義</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-3'><span>引言</span></h2><p><span>　　RISC-V 的目標是成為通用指令集架構，由 RISC-V International 負責發展和維護，不會因單一企業的營收狀況左右指令集的開發。</span></p><p><span>　　傳統指令集架構採增量式設計（incremental），新的處理器除了實現新指令集擴充外，也要實現以往的舊指令集，以達到相容從前的二進位程式，倘若當初思慮不周，設計不良的指令將會一直傳承下去，而 RISC-V 採模組化設計（modular），所有處理器都必須實現核心的指令集模組 RV32I，其餘的擴充指令可依晶片設計者按需求自由加入，由於經過架構師精心設計，使用 RV32I 即可運行一個完整的程式，讓編譯器、組合語言和作業系統的開發者可以只專注在核心的指令集，除此之外，這也使低功耗的晶片設計成為可能。</span></p><p><span>　　RV32I 為 32 位元定長的三運算元指令集，有 32 個通用暫存器和 6 種指令類型，並且立即值（immediate value）總是符號擴充（sign-extension, sext）的。</span></p><p>&nbsp;</p><h2 id='51rv32i-機器語言'><span>5.1　RV32I 機器語言</span></h2><h3 id='511r-type'><span>5.1.1　R type</span></h3><p><span>　　R type 用於編碼暫存器－暫存器指令，目前的 R type 指令都為算數運算指令。</span></p><center>表 5.1：R type 指令編碼</center><figure><table><thead><tr><th style='text-align:center;' ><span>31 - 25</span></th><th style='text-align:center;' ><span>24 - 20</span></th><th style='text-align:center;' ><span>19 - 15</span></th><th style='text-align:center;' ><span>14 - 12</span></th><th style='text-align:center;' ><span>11 - 7</span></th><th style='text-align:center;' ><span>6 - 0</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>funct7</span></td><td style='text-align:center;' ><span>rs2</span></td><td style='text-align:center;' ><span>rs1</span></td><td style='text-align:center;' ><span>funct3</span></td><td style='text-align:center;' ><span>rd</span></td><td style='text-align:center;' ><span>0110011</span></td></tr></tbody></table></figure><p>&nbsp;</p><h4 id='5111addadd）'><span>5.1.1.1　ADD（ADD）</span></h4><ul><li><span>語法：</span><code>ADD rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 000 rd 0110011</code></li><li><span>行為：將 reg[rs1] 加上 reg[rs2] 的結果存入 reg[rd]</span></li><li><span>注意：不檢查結果是否溢出。</span></li></ul><p>&nbsp;</p><h4 id='5112subsubstract）'><span>5.1.1.2　SUB（SUBstract）</span></h4><ul><li><span>語法：</span><code>SUB rd, rs1, rs2</code></li><li><span>編碼：</span><code>0100000 rs2 rs1 000 rd 0110011</code></li><li><span>行為：將 reg[rs1] 減去 reg[rs2] 的結果寫入 reg[rd]</span></li><li><span>注意：不檢查結果是否溢出。</span></li></ul><p>&nbsp;</p><h4 id='5113sllshift-left-logical）'><span>5.1.1.3　SLL（Shift Left Logical）</span></h4><ul><li><span>語法：</span><code>SLL rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 001 rd 0110011</code></li><li><span>行為：將 reg[rs1] 左移 reg</span><span>[</span><span>rs2][4:0] 位元的結果寫入 reg[rd]，空位補 0</span></li><li><span>注意：左移超出 31 位沒有意義，故 reg</span><span>[</span><span>rs2][31:5] 被忽略</span></li></ul><p>&nbsp;</p><h4 id='5114slt-set-if-less-than'><span>5.1.1.4　SLT (Set if Less Than)</span></h4><ul><li><span>語法：</span><code>SLT rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 010 rd 0110011</code></li><li><span>行為：以二補數詮釋 reg[rs1] 和 reg[rs2] 並比較兩者，若 reg[rs1] 較小，對 reg[rd] 寫入 1，否則寫入 0</span></li></ul><p>&nbsp;</p><h4 id='5115sltuset-if-less-than-unsigned）'><span>5.1.1.5　SLTU（Set if Less Than, Unsigned）</span></h4><ul><li><span>語法：</span><code>SLTU rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 011 rd 0110011</code></li><li><span>行為：以無號數詮釋 reg[rs1] 和 reg[rs2] 並比較兩者，若 reg[rs1] 較小，對 reg[rd] 寫入 1，否則寫入 0</span></li></ul><p>&nbsp;</p><h4 id='5116xorexclusive-or）'><span>5.1.1.6　XOR（eXclusive-OR）</span></h4><ul><li><span>語法：</span><code>XOR rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 100 rd 0110011</code></li><li><span>行為：將 reg[rs1] 與 reg[rs2] 按位元取互斥或的結果寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h4 id='5117srlshift-right-logical）'><span>5.1.1.7　SRL（Shift Right Logical）</span></h4><ul><li><span>語法：</span><code>SRL rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 101 rd 0110011</code></li><li><span>行為：將 reg[rs1] 右移 reg</span><span>[</span><span>rs2][4:0] 位元的結果寫入 reg[rd]，空位補 0</span></li><li><span>注意：右移超出 31 位沒有意義，故 reg</span><span>[</span><span>rs2][31:5] 被忽略</span></li></ul><p>&nbsp;</p><h4 id='5118srashift-right-arithmetic）'><span>5.1.1.8　SRA（Shift Right Arithmetic）</span></h4><ul><li><span>語法：</span><code>SRA rd, rs1, rs2</code></li><li><span>編碼：</span><code>0100000 rs2 rs1 101 rd 0110011</code></li><li><span>行為：將 reg[rs1] 右移 reg</span><span>[</span><span>rs2][4:0] 位元的結果寫入 reg[rd]，空位補 reg</span><span>[</span><span>rs1][31]</span></li><li><span>注意：右移超出 31 位沒有意義，故 reg</span><span>[</span><span>rs2][31:5] 被忽略</span></li></ul><p>&nbsp;</p><h4 id='5119oror）'><span>5.1.1.9　OR（OR）</span></h4><ul><li><span>語法：</span><code>OR rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 110 rd 0110011</code></li><li><span>行為：將 reg[rs1] 與 reg[rs2] 按位元取或的結果寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h4 id='51110andand）'><span>5.1.1.10　AND（AND）</span></h4><ul><li><span>語法：</span><code>AND rd, rs1, rs2</code></li><li><span>編碼：</span><code>0000000 rs2 rs1 111 rd 0110011</code></li><li><span>行為：將 reg[rs1] 與 reg[rs2] 按位元取與的結果寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h3 id='512i-type'><span>5.1.2　I type</span></h3><p><span>　　I type 用於編碼與短立即值相關的指令，面對常數時，從組合語言的角度會使用 immediate、offset 或 shift amount 描述，而從機器語言的角度則使用imm 表示，往後行文都採此約定。</span></p><center>表 5.2：I type 指令編碼</center><figure><table><thead><tr><th style='text-align:center;' ><span>31 - 20</span></th><th style='text-align:center;' ><span>19 - 15</span></th><th style='text-align:center;' ><span>14 - 12</span></th><th style='text-align:center;' ><span>11 - 7</span></th><th style='text-align:center;' ><span>6 - 0</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>imm[11:0]</span></td><td style='text-align:center;' ><span>rs1</span></td><td style='text-align:center;' ><span>funct3</span></td><td style='text-align:center;' ><span>rd</span></td><td style='text-align:center;' ><span>opcode</span></td></tr></tbody></table></figure><p>&nbsp;</p><h4 id='5121lbload-byte）'><span>5.1.2.1　LB（Load Byte）</span></h4><ul><li><span>語法：</span><code>LB rd, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:0] rs1 000 rd 0000011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，以該結果為記憶體位址讀取一個位元組，進行符號擴充後寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h4 id='5122lhload-halfword）'><span>5.1.2.2　LH（Load Halfword）</span></h4><ul><li><span>語法：</span><code>LH rd, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:0] rs1 001 rd 0000011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，以該結果為記憶體位址讀取兩個位元組，進行符號擴充後寫入 reg[rd]</span></li><li><span>注意：為確保操作的原子性，(sext(offset) + reg[rs1])[0] 應為 0</span></li></ul><p>&nbsp;</p><h4 id='5123lwload-word）'><span>5.1.2.3　LW（Load Word）</span></h4><ul><li><span>語法：</span><code>LW rd, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:0] rs1 010 rd 0000011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，以該結果為記憶體位址讀取四個位元組寫入 reg[rd]</span></li><li><span>注意：為確保操作的原子性，(sext(offset) + reg[rs1])[1:0] 應為 00</span></li></ul><p>&nbsp;</p><h4 id='5124lbuload-byte-unsigned）'><span>5.1.2.4　LBU（Load Byte, Unsigned）</span></h4><ul><li><span>語法：</span><code>LBU rd, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:0] rs1 100 rd 0000011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，以該結果為記憶體位址讀取一個位元組，進行零擴充後寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h4 id='5125lhuload-halfword-unsigned）'><span>5.1.2.5　LHU（Load Halfword, Unsigned）</span></h4><ul><li><span>語法：</span><code>LHU rd, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:0] rs1 101 rd 0000011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，以該結果為記憶體位址讀取兩個位元組，進行零擴充後寫入 reg[rd]</span></li><li><span>注意：為確保操作的原子性，(sext(offset) + reg[rs1])[0] 應為 0</span></li></ul><p>&nbsp;</p><h4 id='5126addiadd-immediate）'><span>5.1.2.6　ADDI（ADD Immediate）</span></h4><ul><li><span>語法：</span><code>ADDI rd, rs1, immediate</code></li><li><span>編碼：</span><code>imm[11:0] rs1 000 rd 0010011</code></li><li><span>行為將符號擴充 immediate 並加上 reg[rs1] 的結果寫入 reg[rd]</span></li><li><span>編碼：funct3 = 000</span></li><li><span>注意：不檢查結果是否溢出，因 immediate 可為負數，故無 SUBI 指令</span></li></ul><p>&nbsp;</p><h4 id='5127sltiset-if-less-then-immediate）'><span>5.1.2.7　SLTI（Set if Less Then Immediate）</span></h4><ul><li><span>語法：</span><code>SLTI rd, rs1, immediate</code></li><li><span>編碼：</span><code>imm[11:0] rs1 010 rd 0010011</code></li><li><span>行為：以二補數詮釋 reg[rs1] 和符號擴充後的 immediate 並比較兩者，若 reg[rs1] 較小，對 reg[rd] 寫入 1，否則寫入 0</span></li></ul><p>&nbsp;</p><h4 id='5128sltiuset-if-less-then-immediate-unsigned）'><span>5.1.2.8　SLTIU（Set if Less Then Immediate, Unsigned）</span></h4><ul><li><span>語法：</span><code>SLTIU rd, rs1, immediate</code></li><li><span>編碼：</span><code>imm[11:0] rs1 011 rd 0010011</code></li><li><span>行為：以無號數詮釋 reg[rs1] 和符號擴充後的 immediate 並比較兩者，若 reg[rs1] 較小，對 reg[rd] 寫入 1，否則寫入 0</span></li></ul><p>&nbsp;</p><h4 id='5129xoriexclusive-or-immediate）'><span>5.1.2.9　XORI（eXclusive-OR Immediate）</span></h4><ul><li><span>語法：</span><code>XORI rd, rs1, immediate</code></li><li><span>編碼：</span><code>imm[11:0] rs1 100 rd 0010011</code></li><li><span>行為：將 reg[rs1] 與符號擴充後的 immediate 按位元取互斥或的結果寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h4 id='51210orior-immediate）'><span>5.1.2.10　ORI（OR Immediate）</span></h4><ul><li><span>語法：</span><code>ORI rd, rs1, immediate</code></li><li><span>編碼：</span><code>imm[11:0] rs1 110 rd 0010011</code></li><li><span>行為：將 reg[rs1] 與符號擴充後的 immediate 按位元取或的結果寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h4 id='51211andiand-immediate）'><span>5.1.2.11　ANDI（AND Immediate）</span></h4><ul><li><span>語法：</span><code>ANDI rd, rs1, immediate</code></li><li><span>編碼：</span><code>imm[11:0] rs1 111 rd 0010011</code></li><li><span>行為：將 reg[rs1] 與符號擴充後的 immediate 按位元取與的結果寫入 reg[rd]</span></li></ul><p>&nbsp;</p><h4 id='51212sllishift-left-logical-immediate）'><span>5.1.2.12　SLLI（Shift Left Logical Immediate）</span></h4><ul><li><span>語法：</span><code>SLLI rd, rs1, shift amount</code></li><li><span>編碼：</span><code>0000000 imm[4:0] rs1 001 rd 0010011</code></li><li><span>行為：將 reg[rs1] 左移 immediate[4:0] 位元的結果寫入 reg[rd]，空位補 0</span></li><li><span>編碼：imm[11:5] = 00000000，funct3 = 001</span></li><li><span>注意：immediate[11:5] 為固定值，因此欲表示的十進位值無法超過 31</span></li></ul><p>&nbsp;</p><h4 id='51213srlishift-right-logical-immediate）'><span>5.1.2.13　SRLI（Shift Right Logical Immediate）</span></h4><ul><li><span>語法：</span><code>SRLI rd, rs1, shift amount</code></li><li><span>編碼：</span><code>0000000 imm[4:0] rs1 101 rd 0010011</code></li><li><span>行為：將 reg[rs1] 右移 immediate[4:0] 位元的結果寫入 reg[rd]，空位補 0</span></li><li><span>注意：immediate[11:5] 為固定值，因此欲表示的十進位值不得超過 31</span></li></ul><p>&nbsp;</p><h4 id='51214sraishift-right-arithmetic-immediate）'><span>5.1.2.14　SRAI（Shift Right Arithmetic Immediate）</span></h4><ul><li><span>語法：</span><code>SRA rd, rs1, shift amount</code></li><li><span>編碼：</span><code>0100000 imm[4:0] rs1 101 rd 0010011</code></li><li><span>行為：將 reg[rs1] 右移 immediate[4:0] 位元的結果寫入 reg[rd]，空位補 reg</span><span>[</span><span>rs1][31]</span></li><li><span>注意：immediate[11:5] 為固定值，因此欲表示的十進位值無法超過 31</span></li></ul><p>&nbsp;</p><h4 id='51215jalrjump-and-link-register）'><span>5.1.2.15　JALR（Jump And Link Register）</span></h4><ul><li><span>語法：</span><code>JALR rd, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:0] rs1 000 rd 1100111</code></li><li><span>行為：將符號擴充後的 offset 加上 reg[rs1] 寫入 pc，再把 pc[0] 設為 0，最後將原始 pc 值加上 4 寫入 reg[rd]</span></li><li><span>編碼：funct3 = 000</span></li></ul><p>&nbsp;</p><h4 id='51216ecallenvironment-call舊稱-scall）'><span>5.1.2.16　ECALL（Environment CALL，舊稱 SCALL）</span></h4><ul><li><span>語法：</span><code>ECALL</code></li><li><span>編碼：</span><code>00000000000 0 00000 000 00000 1110011</code></li><li><span>行為：透過拋出例外向運行環境請求服務。</span></li><li><span>注意：參數傳遞方式按環境 ABI 規定，並且不同權限下拋出的例外不同。</span></li></ul><p>&nbsp;</p><h4 id='51217ebreakenvironment-breakpoint舊稱-sbreak）'><span>5.1.2.17　EBREAK（Environment BREAKpoint，舊稱 SBREAK）</span></h4><ul><li><span>語法：</span><code>EBREAK</code></li><li><span>編碼：</span><code>00000000000 1 00000 000 00000 1110011</code></li><li><span>行為：透過拋出例外將控制權交還除錯環境。</span></li></ul><p>&nbsp;</p><h4 id='51218fencefence）'><span>5.1.2.18　FENCE（FENCE）</span></h4><p><span>　　FENCE 為記憶體順序指令，其 imm 被切割為 fm、prec 和 succ，見表 5.3。</span></p><center>表 5.3：FENCE 指令的 imm 編碼，prec 為 imm[7:4]，succ 為 imm[3:0]</center><figure><table><thead><tr><th style='text-align:center;' ><span>11 - 8</span></th><th style='text-align:center;' ><span>7</span></th><th style='text-align:center;' ><span>6</span></th><th style='text-align:center;' ><span>5</span></th><th style='text-align:center;' ><span>4</span></th><th style='text-align:center;' ><span>3</span></th><th style='text-align:center;' ><span>2</span></th><th style='text-align:center;' ><span>1</span></th><th style='text-align:center;' ><span>0</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>fm</span></td><td style='text-align:center;' ><span>PI</span></td><td style='text-align:center;' ><span>PO</span></td><td style='text-align:center;' ><span>PR</span></td><td style='text-align:center;' ><span>PW</span></td><td style='text-align:center;' ><span>SI</span></td><td style='text-align:center;' ><span>SO</span></td><td style='text-align:center;' ><span>SR</span></td><td style='text-align:center;' ><span>SW</span></td></tr></tbody></table></figure><p>&nbsp;</p><p><span>　　目前 fm 可為 0000 或 1000（助記符為 TSO），P、S、代表前繼、後繼，而 I、O、R 和 W 分別代表裝置輸入、裝置輸出、記憶體讀取和記憶體寫入，若表明 TSO，則只有 </span><code>FENCE.TSO RW, RW</code><span> 有意義。考慮 </span><code>FENCE IO RW</code><span>，則逗號前的 </span><code>IO</code><span> 表 prec 為 1100，而逗號後的 </span><code>RW</code><span> 表 succ 為 0011。</span></p><p><span>　　關於 FENCE 的使用，請見 </span><a href='https://stackoverflow.com/questions/26374435/what-is-meant-by-the-fence-instruction-in-the-risc-v-instruction-set'><span>What is meant by the FENCE instruction in the RISC-V instruction set?</span></a><span>，關於 FENCE.TSO 的使用，請見 </span><a href='https://stackoverflow.com/questions/56717361/what-is-meant-by-fence-tso-in-the-risc-v-isa'><span>What is meant by FENCE.TSO in the RISC-V ISA?</span></a><span>。</span></p><p>&nbsp;</p><ul><li><span>語法：</span><code>FENCE[.TSO] [I][O][R][W],  [I][O][R][W]</code></li><li><span>編碼：</span><code>fm pred succ rs1 000 rd 0001111</code></li><li><span>行為：根據 imm[7:0] 排序記憶體讀寫和裝置輸入輸出。</span></li><li><span>注意：rs1、 rd 和非 0000 或 1000 的 fm 暫無意義，硬體實現除了應忽略 rs1 和 rd 外，若遇 fm 不為 0000 或 1000，則應視為 0000，而非未定義指令，以保證前向兼容性。對於 RISC-V 組譯器，rs1 和 rd 應設為 0000。</span></li></ul><p>&nbsp;</p><h3 id='513s-type--b-type'><span>5.1.3　S type &amp; B type</span></h3><p><span>　　S type 和 B type 分別用於編碼儲存指令和條件分支指令，B type 為 S type 的延伸，需要注意到 B type 的 immediate 為 13 位元長且單位為位元組，但在編碼中只有 imm[12:1]，不見 imm[0]，這是因為指令至少為兩位元組對齊（RV32I 的壓縮版本 RV32C 的指令長為 16 位元），故 imm[0] 恆為 0，不需儲存。imm 的編碼看似混亂，但可以降低硬體佈線的複雜度，詳細說明見 </span><a href='https://stackoverflow.com/questions/58414772/why-are-risc-v-s-b-and-u-j-instruction-types-encoded-in-this-way'><span>Why are RISC-V S-B and U-J instruction types encoded in this way?</span></a><span>。</span></p><center>表 5.4：S type 編碼格式</center><figure><table><thead><tr><th style='text-align:center;' ><span>31 - 25</span></th><th style='text-align:center;' ><span>24 - 20</span></th><th style='text-align:center;' ><span>19 - 15</span></th><th style='text-align:center;' ><span>14 - 12</span></th><th style='text-align:center;' ><span>11 - 7</span></th><th style='text-align:center;' ><span>6 - 0</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>imm[11:5]</span></td><td style='text-align:center;' ><span>rs2</span></td><td style='text-align:center;' ><span>rs1</span></td><td style='text-align:center;' ><span>funct3</span></td><td style='text-align:center;' ><span>imm[4:0]</span></td><td style='text-align:center;' ><span>opcode</span></td></tr></tbody></table></figure><p>&nbsp;</p><center>表 5.5：B type 編碼格式</center><figure><table><thead><tr><th style='text-align:center;' ><span>31</span></th><th style='text-align:center;' ><span>30 - 25</span></th><th style='text-align:center;' ><span>24 - 20</span></th><th style='text-align:center;' ><span>19 - 15</span></th><th style='text-align:center;' ><span>14 - 12</span></th><th style='text-align:center;' ><span>11 - 8</span></th><th style='text-align:center;' ><span>7</span></th><th style='text-align:center;' ><span>6 - 0</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>imm[12]</span></td><td style='text-align:center;' ><span>imm[10:5]</span></td><td style='text-align:center;' ><span>rs2</span></td><td style='text-align:center;' ><span>rs1</span></td><td style='text-align:center;' ><span>funct3</span></td><td style='text-align:center;' ><span>imm[4:1]</span></td><td style='text-align:center;' ><span>imm[11]</span></td><td style='text-align:center;' ><span>opcode</span></td></tr></tbody></table></figure><p>&nbsp;</p><h4 id='5131sbstore-byte）'><span>5.1.3.1　SB（Store Byte）</span></h4><ul><li><span>語法：</span><code>SB rs2, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:5] rs2 rs1 000 imm[4:0] 0100011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，並以該結果為記憶體位址，將 reg[rs2] 的最低有效位元組寫入其中</span></li><li><span>編碼：funct3 = 000</span></li></ul><p>&nbsp;</p><h4 id='5132shstore-halfword）'><span>5.1.3.2　SH（Store Halfword）</span></h4><ul><li><span>語法：</span><code>SH rs2, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:5] rs2 rs1 001 imm[4:0] 0100011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，並以該結果為記憶體位址，將 reg[rs2] 的兩個最低有效位元組寫入其中</span></li></ul><p>&nbsp;</p><h4 id='5133swstore-word）'><span>5.1.3.3　SW（Store Word）</span></h4><ul><li><span>語法：</span><code>SW rs2, offset(rs1)</code></li><li><span>編碼：</span><code>imm[11:5] rs2 rs1 010 imm[4:0] 0100011</code></li><li><span>行為：先符號擴充 offset 再加上 reg[rs1]，並以該結果為記憶體位址，將 reg[rs2] 的四個最低有效位元組寫入其中</span></li></ul><p>&nbsp;</p><h4 id='5134beqbranch-if-equal）'><span>5.1.3.4　BEQ（Branch if EQual）</span></h4><ul><li><span>語法：</span><code>BEQ rs1, rs2, offset</code></li><li><span>編碼：</span><code>imm[12] imm[10:5] rs2 rs1 000 imm[4:1] imm[11] 1100011</code></li><li><span>行為：若 reg[rs1] 和 reg[rs2] 相等，將符號擴充後的 offset 加上當前 pc 值，並寫入 pc</span></li></ul><p>&nbsp;</p><h4 id='5135bnebranch-if-not-equal）'><span>5.1.3.5　BNE（Branch if Not Equal）</span></h4><ul><li><span>語法：</span><code>BNE rs1, rs2, offset</code></li><li><span>編碼：</span><code>imm[12] imm[10:5] rs2 rs1 001 imm[4:1] imm[11] 1100011</code></li><li><span>行為：若 reg[rs1] 和 reg[rs2] 不相等，將符號擴充後的 offset 加上當前 pc 值，並寫入 pc</span></li></ul><p>&nbsp;</p><h4 id='5136bltbranch-if-less-than）'><span>5.1.3.6　BLT（Branch if Less Than）</span></h4><ul><li><span>語法：</span><code>BLT rs1, rs2, offset</code></li><li><span>編碼：</span><code>imm[12] imm[10:5] rs2 rs1 100 imm[4:1] imm[11] 1100011</code></li><li><span>行為：以二補數詮釋 reg[rs1] 和 reg[rs2]，若 reg[rs1] 小於 reg[rs2]，將符號擴充後的 offset 加上當前 pc 值，並寫入 pc</span></li></ul><p>&nbsp;</p><h4 id='5137bgebranch-if-greater-than-or-equal）'><span>5.1.3.7　BGE（Branch if Greater than or Equal）</span></h4><ul><li><span>語法：</span><code>BGE rs1, rs2, offset</code></li><li><span>編碼：</span><code>imm[12] imm[10:5] rs2 rs1 101 imm[4:1] imm[11] 1100011</code></li><li><span>行為：以二補數詮釋 reg[rs1] 和 reg[rs2]，若 reg[rs1] 大於或等於 reg[rs2]，將符號擴充後的 offset 加上當前 pc 值，並寫入 pc</span></li></ul><p>&nbsp;</p><h4 id='5138bltubranch-if-less-than-unsigned）'><span>5.1.3.8　BLTU（Branch if Less Than, Unsigned）</span></h4><ul><li><span>語法：</span><code>BLTU rs1, rs2, offset</code></li><li><span>編碼：</span><code>imm[12] imm[10:5] rs2 rs1 110 imm[4:1] imm[11] 1100011</code></li><li><span>行為：以無號數詮釋 reg[rs1] 和 reg[rs2]，若 reg[rs1] 小於 reg[rs2]，將符號擴充後的 offset 加上當前 pc 值，並寫入 pc</span></li></ul><p>&nbsp;</p><h4 id='5139bgeubranch-if-greater-than-or-equal-unsigned）'><span>5.1.3.9　BGEU（Branch if Greater than or Equal, Unsigned）</span></h4><ul><li><span>語法：</span><code>BGEU rs1, rs2, offset</code></li><li><span>編碼：</span><code>imm[12] imm[10:5] rs2 rs1 111 imm[4:1] imm[11] 1100011</code></li><li><span>行為：以無號數詮釋 reg[rs1] 和 reg[rs2]，若 reg[rs1] 大於或等於 reg[rs2]，將符號擴充後的 offset 加上當前 pc 值，並寫入 pc</span></li></ul><p>&nbsp;</p><h3 id='514u-type---j-type'><span>5.1.4　U type  &amp; J type</span></h3><p><span>　　U type 和 J type 分別用於編碼長立即值指令與無條件轉跳指令，J type 的 immediate 為 21 位元長，其編碼理由請參考 </span><a href='#513s-type--b-type'><span>S type &amp; B type</span></a><span> 一處的說明。</span></p><center>表 5.6：U type 編碼格式</center><p>&nbsp;</p><figure><table><thead><tr><th style='text-align:center;' ><span>31 - 12</span></th><th style='text-align:center;' ><span>11 - 7</span></th><th style='text-align:center;' ><span>6 - 0</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>imm[31:12]</span></td><td style='text-align:center;' ><span>rd</span></td><td style='text-align:center;' ><span>opcode</span></td></tr></tbody></table></figure><p>&nbsp;</p><center>表 5.7：J type 編碼格式</center><figure><table><thead><tr><th style='text-align:center;' ><span>31</span></th><th style='text-align:center;' ><span>30 - 21</span></th><th style='text-align:center;' ><span>20</span></th><th style='text-align:center;' ><span>19 - 12</span></th><th style='text-align:center;' ><span>11 - 7</span></th><th style='text-align:center;' ><span>6 - 0</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>imm[20]</span></td><td style='text-align:center;' ><span>imm[10:1]</span></td><td style='text-align:center;' ><span>imm[11]</span></td><td style='text-align:center;' ><span>imm[19:12]</span></td><td style='text-align:center;' ><span>rd</span></td><td style='text-align:center;' ><span>opcode</span></td></tr></tbody></table></figure><p>&nbsp;</p><h4 id='5141luiload-upper-immediate）'><span>5.1.4.1　LUI（Load Upper Immediate）</span></h4><ul><li><span>語法：</span><code>LUI rd, immediate</code></li><li><span>編碼：</span><code>imm[31:12] rd 0110111</code></li><li><span>行為：對 imm 進行符號擴充再邏輯左移 12 位元，寫入 reg[rd]</span></li><li><span>注意：immediate 應為目標整數的前 20 位</span></li></ul><p>&nbsp;</p><h4 id='5142auipcadd-upper-immediate-to-program-counter）'><span>5.1.4.2　AUIPC（Add Upper Immediate to Program Counter）</span></h4><ul><li><span>語法：</span><code>AUIPC rd, immediate</code></li><li><span>編碼：</span><code>imm[31:12] rd 0010111</code></li><li><span>行為：對 imm 進行符號擴充再邏輯左移 12 位元，並與當前 pc 值相加，結果寫入 reg[rd]</span></li><li><span>注意：immediate 應為目標整數的前 20 位</span></li></ul><p>&nbsp;</p><h4 id='5143jaljump-and-link）'><span>5.1.4.3　JAL（Jump And Link）</span></h4><ul><li><span>語法：</span><code>JAL rd, offset</code></li><li><span>編碼：</span><code>imm[20] imm[10:1] imm[11] imm[19:12] rd 1101111</code></li><li><span>行為：將當前 pc 值加上 4 寫入 reg[rd]，再將符號擴充後的 offset  寫入 pc</span></li></ul><p>&nbsp;</p><h2 id='52rv32i-組合語言'><span>5.2　RV32I 組合語言</span></h2><h3 id='521暫存器命名慣例'><span>5.2.1　暫存器命名慣例</span></h3><center>表 5.8：暫存器命名慣例</center><figure><table><thead><tr><th style='text-align:center;' ><span>名稱</span></th><th style='text-align:center;' ><span>ABI 助記符</span></th><th style='text-align:center;' ><span>含義</span></th><th style='text-align:center;' ><span>函數呼叫前後是否變動</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>x0</span></td><td style='text-align:center;' ><span>zero</span></td><td style='text-align:center;' ><span>零</span></td><td style='text-align:center;' ><span>物理上不可變</span></td></tr><tr><td style='text-align:center;' ><span>x1</span></td><td style='text-align:center;' ><span>ra</span></td><td style='text-align:center;' ><span>函數返回位址</span></td><td style='text-align:center;' ><span>是</span></td></tr><tr><td style='text-align:center;' ><span>x2</span></td><td style='text-align:center;' ><span>sp</span></td><td style='text-align:center;' ><span>堆疊指標</span></td><td style='text-align:center;' ><span>否</span></td></tr><tr><td style='text-align:center;' ><span>x3</span></td><td style='text-align:center;' ><span>gp</span></td><td style='text-align:center;' ><span>全域指標</span></td><td style='text-align:center;' ><span>不可配置</span></td></tr><tr><td style='text-align:center;' ><span>x4</span></td><td style='text-align:center;' ><span>tp</span></td><td style='text-align:center;' ><span>執行緒指標</span></td><td style='text-align:center;' ><span>不可配置</span></td></tr><tr><td style='text-align:center;' ><span>x5 - x7</span></td><td style='text-align:center;' ><span>t0 - t2</span></td><td style='text-align:center;' ><span>臨時暫存器</span></td><td style='text-align:center;' ><span>是</span></td></tr><tr><td style='text-align:center;' ><span>x8</span></td><td style='text-align:center;' ><span>s0 / fp</span></td><td style='text-align:center;' ><span>保存暫存器 / 幀指標</span></td><td style='text-align:center;' ><span>否</span></td></tr><tr><td style='text-align:center;' ><span>x9</span></td><td style='text-align:center;' ><span>s1</span></td><td style='text-align:center;' ><span>保存暫存器</span></td><td style='text-align:center;' ><span>否</span></td></tr><tr><td style='text-align:center;' ><span>x10 - x17</span></td><td style='text-align:center;' ><span>a0 - a7</span></td><td style='text-align:center;' ><span>參數暫存器</span></td><td style='text-align:center;' ><span>是</span></td></tr><tr><td style='text-align:center;' ><span>x18 - x27</span></td><td style='text-align:center;' ><span>s2 - s11</span></td><td style='text-align:center;' ><span>保存暫存器</span></td><td style='text-align:center;' ><span>否</span></td></tr><tr><td style='text-align:center;' ><span>x28 - x31</span></td><td style='text-align:center;' ><span>t3 - t6</span></td><td style='text-align:center;' ><span>臨時暫存器</span></td><td style='text-align:center;' ><span>是</span></td></tr></tbody></table></figure><p><span>※ 臨時暫存器和保存暫存器並非連續編號的原因是為了相容 RV32E。</span></p><p>&nbsp;</p><h3 id='522偽指令'><span>5.2.2　偽指令</span></h3><p><span>　　在</span><a href='#51rv32i-機器語言'><span>機器語言</span></a><span>中已經列出所有原生的指令及對應語法，將這些語法與表 5.9 的偽指令結合，即形成 RV32I 組合語言。</span></p><center>表 5.9：RV32I 中的偽指令</center><figure><table><thead><tr><th style='text-align:left;' ><span>偽指令</span></th><th style='text-align:left;' ><span>實際指令</span></th><th style='text-align:left;' ><span>行為</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><code>LA rd, symbol</code><span>（非 PIC）</span></td><td style='text-align:left;' ><code>AUIPC rd, delta[31:12] + delta[11]</code><br><code>ADDI rd, rd, delta[11:0]</code></td><td style='text-align:left;' ><span>載入絕對位址</span><br><span>delta = symbol - pc</span></td></tr><tr><td style='text-align:left;' ><code>LA rd, symbol</code><span>（PIC）</span></td><td style='text-align:left;' ><code>AUIPC rd, delta[31:12] + delta[11]</code><br><code>ADDI rd, rd, delta[11:0]</code></td><td style='text-align:left;' ><span>載入絕對位址</span><br><span>delta = GOT[symbol] - pc</span></td></tr><tr><td style='text-align:left;' ><code>LLA rd, symbol</code></td><td style='text-align:left;' ><code>AUIPC rd, delta[31:12] + delta[11]</code><br><code>ADDI rd, rd, delta[11:0]</code></td><td style='text-align:left;' ><span>載入區域位址</span><br><span>delta = symbol - pc</span></td></tr><tr><td style='text-align:left;' ><code>L{B|H|W} rd, symbol</code></td><td style='text-align:left;' ><code>AUIPC rd, delta[31:12] + delta[11]</code><br><code>L{B|H|W} rd, delta[11:0](rd)</code></td><td style='text-align:left;' ><span>載入全域</span><br><span>delta = symbol - pc</span></td></tr><tr><td style='text-align:left;' ><code>S{B|H|W} rd, symbol, rt</code></td><td style='text-align:left;' ><code>AUIPC rt, delta[31:12] + delta[11]</code><br><code>S{B|H|W} rd, delta[11:0](rt)</code></td><td style='text-align:left;' ><span>儲存全域</span><br><span>delta = symbol - pc</span><br><span>rt 用來儲存中間結果</span></td></tr><tr><td style='text-align:left;' ><code>NOP</code></td><td style='text-align:left;' ><code>ADDI x0, x0, 0</code></td><td style='text-align:left;' ><span>無操作</span></td></tr><tr><td style='text-align:left;' ><code>LI rd, immediate</code></td><td style='text-align:left;' ><code>ADDI rd, x0, immediate</code><span> 或</span><br><code>LUI rd, immediate[31:12] + immediate[11]</code><br><code>ADDI rd, rd, immediate[11:0]</code></td><td style='text-align:left;' ><span>載入立即值</span><br><span>使用上者或下者視 immediate 大小而定</span></td></tr><tr><td style='text-align:left;' ><code>MV rd, rs</code></td><td style='text-align:left;' ><code>ADDI rd, rs, 0</code></td><td style='text-align:left;' ><span>將 reg[rs] 寫入 reg[rd]</span></td></tr><tr><td style='text-align:left;' ><code>NOT rd, rs</code></td><td style='text-align:left;' ><code>XORI rd, rs, -1</code></td><td style='text-align:left;' ><span>將 reg[rs] 的一補數寫入 reg[rd]</span></td></tr><tr><td style='text-align:left;' ><code>NEG rd, rs</code></td><td style='text-align:left;' ><code>SUB rd, x0, rs</code></td><td style='text-align:left;' ><span>將 reg[rs] 的二補數寫入 reg[rd]</span></td></tr><tr><td style='text-align:left;' ><code>SEQZ rd, rs</code></td><td style='text-align:left;' ><code>SLTIU rd, rs, 1</code></td><td style='text-align:left;' ><span>若 reg[rs] 為零，對 reg[rd] 寫入 1，否則寫入 0</span></td></tr><tr><td style='text-align:left;' ><code>SNEZ rd, rs</code></td><td style='text-align:left;' ><code>SLTU rd, x0, rs</code></td><td style='text-align:left;' ><span>若 reg[rs] 不為零，對 reg[rd] 寫入 1，否則寫入 0</span></td></tr><tr><td style='text-align:left;' ><code>SLTZ rd, rs</code></td><td style='text-align:left;' ><code>SLT rd, rs, x0</code></td><td style='text-align:left;' ><span>若 reg[rs] 小於零，對 reg[rd] 寫入 1，否則寫入 0</span></td></tr><tr><td style='text-align:left;' ><code>SGTZ rd, rs</code></td><td style='text-align:left;' ><code>SLT rd, x0, rs</code></td><td style='text-align:left;' ><span>若 reg[rs] 大於零，對 reg[rd] 寫入 1，否則寫入 0</span></td></tr><tr><td style='text-align:left;' ><code>BEQZ rs, offset</code></td><td style='text-align:left;' ><code>BEQ rs, x0, offset</code></td><td style='text-align:left;' ><span>若 reg[rs] 為零則分支</span></td></tr><tr><td style='text-align:left;' ><code>BNEZ rs, offset</code></td><td style='text-align:left;' ><code>BNE rs, x0, offset</code></td><td style='text-align:left;' ><span>若 reg[rs] 不為零則分支</span></td></tr><tr><td style='text-align:left;' ><code>BLEZ rs, offset</code></td><td style='text-align:left;' ><code>BGE x0, rs, offset</code></td><td style='text-align:left;' ><span>若 reg[rs] 不大於零則分支</span></td></tr><tr><td style='text-align:left;' ><code>BGEZ rs, offset</code></td><td style='text-align:left;' ><code>BGE rs, x0, offset</code></td><td style='text-align:left;' ><span>若 reg[rs] 不小於零則分支</span></td></tr><tr><td style='text-align:left;' ><code>BLTZ rs, offset</code></td><td style='text-align:left;' ><code>BLT rs, x0, offset</code></td><td style='text-align:left;' ><span>若 reg[rs] 小於零則分支</span></td></tr><tr><td style='text-align:left;' ><code>BGTZ rs, offset</code></td><td style='text-align:left;' ><code>BLT x0, rs, offset</code></td><td style='text-align:left;' ><span>若 reg[rs] 大於零則分支</span></td></tr><tr><td style='text-align:left;' ><code>BGT rs, rt, offset</code></td><td style='text-align:left;' ><code>BLT rt, rs, offset</code></td><td style='text-align:left;' ><span>以二補數詮釋，若 reg[rs] 大於 reg[rt] 則分支</span></td></tr><tr><td style='text-align:left;' ><code>BLE rs, rt, offset</code></td><td style='text-align:left;' ><code>BGE rt, rs, offset</code></td><td style='text-align:left;' ><span>以二補數詮釋，若 reg[rs] 不大於 reg[rt] 則分支</span></td></tr><tr><td style='text-align:left;' ><code>BGTU rs, rt, offset</code></td><td style='text-align:left;' ><code>BLTU rt, rs, offset</code></td><td style='text-align:left;' ><span>以無號數詮釋，若 reg[rs] 大於 reg[rt] 則分支</span></td></tr><tr><td style='text-align:left;' ><code>BLEU rs, rt, offset</code></td><td style='text-align:left;' ><code>BGEU rt, rs, offset</code></td><td style='text-align:left;' ><span>以無號數詮釋，若 reg[rs] 不大於 reg[rt] 則分支</span></td></tr><tr><td style='text-align:left;' ><code>J offset</code></td><td style='text-align:left;' ><code>JAL x0, offset</code></td><td style='text-align:left;' ><span>轉跳</span></td></tr><tr><td style='text-align:left;' ><code>JAL offset</code></td><td style='text-align:left;' ><code>JAL x1, offset</code></td><td style='text-align:left;' ><span>轉跳，並將位址寫入 x1</span></td></tr><tr><td style='text-align:left;' ><code>JR rs</code></td><td style='text-align:left;' ><code>JALR x0, 0(rs)</code></td><td style='text-align:left;' ><span>轉跳至 reg[rs] 儲存的位址</span></td></tr><tr><td style='text-align:left;' ><code>JALR rs</code></td><td style='text-align:left;' ><code>JALR x1, 0(rs)</code></td><td style='text-align:left;' ><span>轉跳至 reg[rs] 儲存的位址，並將位址寫入 x1</span></td></tr><tr><td style='text-align:left;' ><code>RET</code></td><td style='text-align:left;' ><code>JALR x0, 0(x1)</code></td><td style='text-align:left;' ><span>自子程式中返回</span></td></tr><tr><td style='text-align:left;' ><code>CALL offset</code></td><td style='text-align:left;' ><code>AUIPC x1, offset[31:12] + offset[11]</code><br><code>JALR x1, offset[11:0](x1)</code></td><td style='text-align:left;' ><span>呼叫遠處的子程式</span></td></tr><tr><td style='text-align:left;' ><code>TAIL offest</code></td><td style='text-align:left;' ><code>AUIPC x6, offset[31:12] + offset[11]</code><br><code>JALR x0, offset[11:0](x6)</code></td><td style='text-align:left;' ><span>尾呼叫遠處的子程式</span></td></tr><tr><td style='text-align:left;' ><code>FENCE</code></td><td style='text-align:left;' ><code>FENCE IORW, IORW</code></td><td style='text-align:left;' ><span>排序記憶體讀寫和裝置輸入輸出</span></td></tr></tbody></table></figure><p><span>※ 以上提及的 delta 若涉入 GOT（global offset table）由運行期（runtime）連結器計算，否則由編譯期（compiler-time）連結器計算。</span></p><p>&nbsp;</p><h3 id='523程式實例'><span>5.2.3　程式實例</span></h3><h4 id='5231變數交換'><span>5.2.3.1　變數交換</span></h4><p><span>　　以下展示如何進行暫存器間的值交換，若要進行涉及記憶體的值交換，需要先使用 </span><code>lw</code><span> 從記憶體讀取值，再進行暫存器間的變數交換，最後使用 </span><code>sw</code><span> 將值寫回記憶體中，注意涉及記憶體的值交換並非原子性的。</span></p><center>使用額外暫存器的交換</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 有其他可用暫存器</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># s0 和 s1 為欲交換的兩個暫存器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">MV</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">t0</span>, s0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">MV</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">s0</span>, s1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">MV</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">s1</span>, t0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 128px;"></div><div class="CodeMirror-gutters" style="display: none; height: 128px;"></div></div></div></pre><center>不使用額外暫存器的交換</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 無其他可用暫存器</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># s0 和 s1 為欲交換的兩個暫存器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 注意互斥或的性質：a ⊕ a ⊕ b = b</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">XOR</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, s0, s1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">XOR</span> &nbsp; &nbsp; <span class="cm-keyword">s1</span>, s0, s1 <span class="cm-comment"># (s0 ⊕ s1) ⊕ s1 = s0，目前的 s1 的值是原本 s0 的值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">XOR</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, s0, s1 <span class="cm-comment"># (s0 ⊕ s1) ⊕ s0 = s1，目前的 s0 的值是原本 s1 的值</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p>&nbsp;</p><h4 id='5232大數加法'><span>5.2.3.2　大數加法</span></h4><p><span>　　RV32I 只有 32 位元的整數加法，但可透過多個暫存器模擬出 32 的整數倍長的加法，以下展示如何模擬 64 位元整數加法。</span></p><center>64 位元整數加法</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># s0 和 s1 分別為計算結果的高低位，s2 和 s3 分別為被加數的高低位，s4 和 s5 分別為加數的高低位</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 若 s3 或 s5 後續不會用到，可以用來代替 t0 的角色，減少暫存器數量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">s1</span>, s3, s5 <span class="cm-comment"># 低位相加</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, s2, s4 <span class="cm-comment"># 高位相加</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">SLTU</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, s1, s3 <span class="cm-comment"># 檢查低位相加有無進位，以無號數詮釋 s1、s3 和 s5，若有進位，則 s1 會小於 s3 和 s5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, s0, t0 <span class="cm-comment"># 加上進位，有進位則 t0 為 1，反之為 0</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p>&nbsp;</p><h4 id='5233檢查溢位'><span>5.2.3.3　檢查溢位</span></h4><p><span>　　由於 </span><code>ADD</code><span>、</span><code>SUB</code><span> 和 </span><code>ADDI</code><span> 不會拋出溢位異常，如果軟體在意是否溢出，需要自行檢查，以下分別以 </span><code>ADD</code><span> 展示如何檢查有號數溢位和無號數溢位。</span></p><center>無號數溢位處理</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 帶溢位檢查的無號數加法</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># s0 為計算結果，s1 和 s2 為被加數和加數</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, s1, s2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">BLTU</span> &nbsp; &nbsp;<span class="cm-keyword">s0</span>, s1, overflow <span class="cm-comment"># 若 s0 小於 s1 或 s2，表示溢位</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">overflow:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 溢位處理</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 179px;"></div><div class="CodeMirror-gutters" style="display: none; height: 179px;"></div></div></div></pre><center>有號數溢位處理</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 帶溢位檢查的有號數加法</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># s0 為計算結果，s1 和 s2 為被加數和加數</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADD</span> &nbsp; &nbsp; <span class="cm-keyword">s0</span>, s1, s2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">SLTI</span> &nbsp; &nbsp;<span class="cm-keyword">t0</span>, s2, 0 &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 檢查 s2 是否為負</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">SLT</span> &nbsp; &nbsp; <span class="cm-keyword">t1</span>, s0, s1 &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 檢查 s0 是否小於 s1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">BNE</span> &nbsp; &nbsp; <span class="cm-keyword">t0</span>, t1, overflow <span class="cm-comment"># 當 s2 為負且 s0 大於 s1 或 s2 為正且 s0 小於 s1 則發生溢位</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">overflow:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 溢位處理</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p>&nbsp;</p><h4 id='5234函數編寫'><span>5.2.3.4　函數編寫</span></h4><p><span>　　以下為遵守 ILP32* ABI 和 LP64* ABI 的函數模板，關於 ILP32 和 LP64 的意義請參考 </span><a href='https://en.cppreference.com/w/cpp/language/types#Data_models'><span>Data models</span></a><span> 。</span></p><center>RISC-V ILP32* ABI 和 LP64* ABI 的函數模板</center><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="assembly"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="assembly"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 10.8px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">function_name:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># function_name 為函數名稱</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, -framesize &nbsp;<span class="cm-comment"># 調整堆疊指標，分配堆疊幀，framesize 為一常數，表示堆疊幀的大小</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">SW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span>, framesize-4(<span class="cm-variable">sp</span>) <span class="cm-comment"># 保存函數返回位址</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 保存會用到的 sx 暫存器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 函數內容</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 復原用到的 sx 暫存器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">LW</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span>, framesize-4(<span class="cm-variable">sp</span>) <span class="cm-comment"># 復原函數返回位址</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ADDI</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>, <span class="cm-variable">sp</span>, framesize &nbsp; <span class="cm-comment"># 復原堆疊指標，釋放堆疊幀</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">RET</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 返回呼叫的函式</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p>&nbsp;</p><h2 id='參考資料-3'><span>參考資料</span></h2><p><span>文中已有超連結的資料不在此處列出。</span></p><ol start='' ><li><span>“The RISC-V Instruction Set Manual, Volume I: User-Level ISA, Document Version 20191213”, Editors Andrew Waterman and Krste Asanović, RISC-V Foundation, December 2019. </span><a href='https://github.com/riscv/riscv-isa-manual/releases/download/Ratified-IMAFDQC/riscv-spec-20191213.pdf' target='_blank' class='url'>https://github.com/riscv/riscv-isa-manual/releases/download/Ratified-IMAFDQC/riscv-spec-20191213.pdf</a><span>.</span></li><li><span>“The RISC-V Reader: an open architecture Atlas”, Andrew Waterman and David Patterson, Strawberry Canyon, 2017.</span></li><li><span>“RISC-V Instruction Formats”, Steven Ho, CS61C, UC Berkeley, June 2018. </span><a href='https://inst.eecs.berkeley.edu/~cs61c/resources/su18_lec/Lecture7.pdf' target='_blank' class='url'>https://inst.eecs.berkeley.edu/~cs61c/resources/su18_lec/Lecture7.pdf</a><span>.</span></li><li><span>“RISC-V Instruction Set Architecture”, James Hoe, 18-447, Carnegie Mellon University, February 2021. </span><a href='http://users.ece.cmu.edu/~jhoe/course/ece447/S20handouts/L02.pdf' target='_blank' class='url'>http://users.ece.cmu.edu/~jhoe/course/ece447/S20handouts/L02.pdf</a><span>.</span></li><li><span>“RISC-V ELF psABI specification”, Palmer Dabbelt, Stefan O&#39;Rear, Kito Cheng, Andrew Waterman, Michael Clark, Alex Bradbury, David Horner, Max Nordlund, and Karsten Merker, Sam Elliott, 2019. </span><a href='https://github.com/riscv/riscv-elf-psabi-doc/blob/master/riscv-elf.md' target='_blank' class='url'>https://github.com/riscv/riscv-elf-psabi-doc/blob/master/riscv-elf.md</a><span>.</span></li><li><span>“RISC-V Assembly Programmer&#39;s Manual”, Palmer Dabbelt, Michael Clark, Alex Bradury, 2017. </span><a href='https://github.com/riscv/riscv-asm-manual/blob/master/riscv-asm.md' target='_blank' class='url'>https://github.com/riscv/riscv-asm-manual/blob/master/riscv-asm.md</a><span>.</span></li><li><span>“RISC-V Assembly Language Programming”, John Winans, March 2021. </span><a href='https://github.com/johnwinans/rvalp/releases/download/v0.12/rvalp.pdf' target='_blank' class='url'>https://github.com/johnwinans/rvalp/releases/download/v0.12/rvalp.pdf</a><span>.</span></li><li><span>“RISC-V Assembly Language Programmer Manual Part I”, Shakti Development Team, 2020. </span><a href='https://shakti.org.in/docs/risc-v-asm-manual.pdf' target='_blank' class='url'>https://shakti.org.in/docs/risc-v-asm-manual.pdf</a><span>.</span></li><li><span>“Computer Architecture: A Quantitative Approach”,  David Patterson and John Hennessy, Morgan Kaufmann, 2019.</span></li></ol><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-6sprite-executable-format'><span>Chapter 6　Sprite Executable Format</span></h1><hr /><left>作者：待定</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-4'><span>引言</span></h2><h2 id='61現有格式回顧'><span>6.1　現有格式回顧</span></h2><h3 id='611aout'><span>6.1.1　a.out</span></h3><h3 id='612elf'><span>6.1.2　ELF</span></h3><h3 id='613pe'><span>6.1.3　PE</span></h3><h3 id='614mach-o'><span>6.1.4　Mach-O</span></h3><h2 id='62檔案格式'><span>6.2　檔案格式</span></h2><h3 id='621object'><span>6.2.1　Object</span></h3><h3 id='622executable'><span>6.2.2　Executable</span></h3><h2 id='63未來規劃'><span>6.3　未來規劃</span></h2><h2 id='參考資料-4'><span>參考資料</span></h2><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-7編譯器'><span>Chapter 7　編譯器</span></h1><hr /><left>作者：陳忠義</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-5'><span>引言</span></h2><h2 id='71名詞定義'><span>7.1　名詞定義</span></h2><h3 id='71n標記'><span>7.1.n　標記</span></h3><p><span>　　標記（token）為構成語言的最小單位，由字元組成。</span></p><h3 id='71n標記流'><span>7.1.n　標記流</span></h3><p><span>　　標記流（token stream）由一連串的標記所組成，可以由語法分析後得到。</span></p><h3 id='71n詞法分析'><span>7.1.n　詞法分析</span></h3><p><span>　　詞法分析（lexical analysis）用來檢驗輸入字串是否符合語言對標記的定義。</span></p><p><span>　　例：「標」為中文的一個標記，但「a」不是。</span></p><h3 id='71n語法分析'><span>7.1.n　語法分析</span></h3><p><span>　　語法分析（syntactic analysis）用來檢驗輸入語句是否符合語言對語句的定義。</span></p><p><span>　　例：「你好嗎？」符合中文的語法，「？好你嗎」則不符合。</span></p><h3 id='71n語意分析'><span>7.1.n　語意分析</span></h3><p><span>　　語意分析（semantic analysis）用來檢驗輸入語句的前後文是否符合邏輯。</span></p><p><span>　　例：</span><code>int a = &quot;a&quot;;</code><span> 不符合語意，因為 </span><code>&quot;a&quot;</code><span> 為字串而非數字。</span></p><h3 id='71n抽象語法樹'><span>7.1.n　抽象語法樹</span></h3><p><span>　　抽象語法樹（abstract syntax tree）為一種表達語言結構的方式。</span></p><p><span>　　例：</span><code>1 + 2</code><span> 可以被分解為以 </span><code>+</code><span> 為根，</span><code>1</code><span> 和 </span><code>2</code><span> 為子節點的樹。</span></p><h3 id='71n符號表'><span>7.1.n　符號表</span></h3><p><span>　　符號表（symbol table）為紀錄識別字（identifier）及相關資訊的表。</span></p><h2 id='72使用者介面'><span>7.2　使用者介面</span></h2><h2 id='73詞法分析'><span>7.3　詞法分析</span></h2><h3 id='73n錯誤處理'><span>7.3.n　錯誤處理</span></h3><h2 id='74抽象語法樹結構'><span>7.4　抽象語法樹結構</span></h2><h2 id='75符號表'><span>7.5　符號表</span></h2><h2 id='76語法分析'><span>7.6　語法分析</span></h2><h3 id='76n錯誤處理'><span>7.6.n　錯誤處理</span></h3><h2 id='77語意分析'><span>7.7　語意分析</span></h2><h3 id='77n錯誤處理'><span>7.7.n　錯誤處理</span></h3><h2 id='78中間語言生成'><span>7.8　中間語言生成</span></h2><h2 id='79機器無關優化'><span>7.9　機器無關優化</span></h2><h3 id='791抽象語法樹優化'><span>7.9.1　抽象語法樹優化</span></h3><h4 id='7911表達式簡化'><span>7.9.1.1　表達式簡化</span></h4><h4 id='7912常數折疊'><span>7.9.1.2　常數折疊</span></h4><h4 id='7913死碼刪除'><span>7.9.1.3　死碼刪除</span></h4><h3 id='792中間語言優化'><span>7.9.2　中間語言優化</span></h3><h4 id='7921尾遞迴消除'><span>7.9.2.1　尾遞迴消除</span></h4><h2 id='710sil-檔案生成'><span>7.10　.sil 檔案生成</span></h2><h2 id='711未來規劃'><span>7.11　未來規劃</span></h2><h2 id='參考資料-5'><span>參考資料</span></h2><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-8組譯器'><span>Chapter 8　組譯器</span></h1><hr /><left>作者：待定</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-6'><span>引言</span></h2><h2 id='81名詞定義'><span>8.1　名詞定義</span></h2><h2 id='82用者介面'><span>8.2　用者介面</span></h2><h2 id='83詞法分析'><span>8.3　詞法分析</span></h2><h3 id='83n錯誤處理'><span>8.3.n　錯誤處理</span></h3><h2 id='84語法分析'><span>8.4　語法分析</span></h2><h3 id='84n錯誤處理'><span>8.4.n　錯誤處理</span></h3><h2 id='85機器語言生成'><span>8.5　機器語言生成</span></h2><h2 id='86機器相關優化'><span>8.6　機器相關優化</span></h2><h3 id='861零暫存器取代'><span>8.6.1　零暫存器取代</span></h3><h2 id='87sof-檔案生成'><span>8.7　.sof 檔案生成</span></h2><h2 id='88未來規劃'><span>8.8　未來規劃</span></h2><h2 id='參考資料-6'><span>參考資料</span></h2><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-9連結器'><span>Chapter 9　連結器</span></h1><hr /><left>作者：待定</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-7'><span>引言</span></h2><h2 id='91名詞定義'><span>9.1　名詞定義</span></h2><h2 id='92使用者介面'><span>9.2　使用者介面</span></h2><h2 id='93符號解析'><span>9.3　符號解析</span></h2><h3 id='93n錯誤處理'><span>9.3.n　錯誤處理</span></h3><h2 id='94空間分配'><span>9.4　空間分配</span></h2><h2 id='95重定位'><span>9.5　重定位</span></h2><h2 id='96se-檔案生成'><span>9.6　.se 檔案生成</span></h2><h2 id='97未來規劃'><span>9.7　未來規劃</span></h2><h2 id='參考資料-7'><span>參考資料</span></h2><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='chapter-10仿真器'><span>Chapter 10　仿真器</span></h1><hr /><left>作者：待定</left><p style="text-align:right;"><a href="#目錄">回目錄</a></p><h2 id='引言-8'><span>引言</span></h2><h2 id='101名詞定義'><span>10.1　名詞定義</span></h2><h2 id='102se-檔案運行環境'><span>10.2　.se 檔案運行環境</span></h2><h3 id='1021指令集'><span>10.2.1　指令集</span></h3><h3 id='1022架構'><span>10.2.2　架構</span></h3><h3 id='1023暫存器'><span>10.2.3　暫存器</span></h3><h3 id='1024記憶體'><span>10.2.4　記憶體</span></h3><h3 id='1025庫函數支援'><span>10.2.5　庫函數支援</span></h3><h2 id='103反組譯器'><span>10.3　反組譯器</span></h2><h2 id='104圖形化介面設計'><span>10.4　圖形化介面設計</span></h2><h2 id='105未來規劃'><span>10.5　未來規劃</span></h2><h2 id='參考資料-8'><span>參考資料</span></h2><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h1 id='變更紀錄'><span>變更紀錄</span></h1><hr /><p style="text-align:right;"><a href="#目錄">回目錄</a></p><figure><table><thead><tr><th><span>版本</span></th><th><span>日期</span></th><th><span>內容</span></th></tr></thead><tbody><tr><td><span>0.9.3</span></td><td><span>2021/6/9</span></td><td><span>刪除 ch4 引言的錯誤描述</span></td></tr><tr><td><span>0.9.2</span></td><td><span>2021/6/9</span></td><td><span>修改 ch4 的程式碼註解</span><br><span>修正 4.3.1.4 的程式碼錯誤</span></td></tr><tr><td><span>0.9.1</span></td><td><span>2021/6/9</span></td><td><span>修正 4.2.6 為四級標題的問題</span></td></tr><tr><td><span>0.9.0</span></td><td><span>2021/6/9</span></td><td><span>完成 ch4</span></td></tr><tr><td><span>0.8.0</span></td><td><span>2021/6/8</span></td><td><span>刪除 ch4 無號數版本指令，未來可能回歸</span></td></tr><tr><td><span>0.7.1</span></td><td><span>2021/6/8</span></td><td><span>修正 4.2.3 的錯誤敘述</span><br><span>修改 4.2 的原始碼，使概念更加清晰</span></td></tr><tr><td><span>0.7.0</span></td><td><span>2021/6/8</span></td><td><span>增加 ch4 的內容</span></td></tr><tr><td><span>0.6.4</span></td><td><span>2021/6/7</span></td><td><span>修正 4.1.6.7 的錯誤</span></td></tr><tr><td><span>0.6.3</span></td><td><span>2021/6/7</span></td><td><span>移除所有程式碼塊的編碼</span></td></tr><tr><td><span>0.6.2</span></td><td><span>2021/6/7</span></td><td><span>修改 ch8 的標題順序</span><br><span>編號 5.2.3 的程式碼</span><br><span>新增章節作者訊息</span></td></tr><tr><td><span>0.6.1</span></td><td><span>2021/6/6</span></td><td><span>修正 ch4 部分內容的用詞</span></td></tr><tr><td><span>0.6.0</span></td><td><span>2021/6/6</span></td><td><span>增加 ch4 標題</span><br><span>增加 ch4 的內容</span></td></tr><tr><td><span>0.5.1</span></td><td><span>2021/6/6</span></td><td><span>修正 5.2.2 的用詞</span></td></tr><tr><td><span>0.5.0</span></td><td><span>2021/6/6</span></td><td><span>增加 ch4 的內容</span></td></tr><tr><td><span>0.4.0</span></td><td><span>2021/6/5</span></td><td><span>增加 7.1 的內容</span></td></tr><tr><td><span>0.3.1</span></td><td><span>2021/6/3</span></td><td><span>微調 1.2.1、1.2.2、表 5.9 部分用詞</span></td></tr><tr><td><span>0.3.0</span></td><td><span>2021/6/2</span></td><td><span>增加 ch3、ch4、ch6、ch7、ch8、ch9、ch10、ch11 的標題</span><br><span>微調 ch2 的部分用詞</span></td></tr><tr><td><span>0.2.4</span></td><td><span>2021/6/2</span></td><td><span>刪除摘要與 1.3.3 的多餘文字</span><br><span>增加表 5.8 用詞</span><br><span>更新版本號更新規則</span></td></tr><tr><td><span>0.2.3</span></td><td><span>2021/6/2</span></td><td><span>修正 2.3 和 2.5 的部分用詞</span></td></tr><tr><td><span>0.2.2</span></td><td><span>2021/6/2</span></td><td><span>修正 2.2 的部分用詞，使概念更加清晰</span></td></tr><tr><td><span>0.2.1</span></td><td><span>2021/6/2</span></td><td><span>修正 2.3 和 2.4 的部分用詞</span></td></tr><tr><td><span>0.2.0</span></td><td><span>2021/6/2</span></td><td><span>完成 ch5</span></td></tr><tr><td><span>0.1.1</span></td><td><span>2021/6/2</span></td><td><span>增加 ch5 的內容</span></td></tr><tr><td><span>0.1.0</span></td><td><span>2021/6/1</span></td><td><span>增加摘要、ch1 和 ch2的內容</span></td></tr><tr><td><span>0.0.0</span></td><td><span>2021/5/31</span></td><td><span>確定文件章節</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2 id='版本號更新規則'><span>版本號更新規則</span></h2><ul><li><p><span>以 1.2.3 為版本號，則</span></p><ol start='' ><li><span>增加全新章節和標題或刪除已有章節和標題會使版本號變更為 2.0.0（0.a.b 版本遇此情況適用規則 2）</span></li><li><span>增加或刪除某些章節的內容會使版本號變更為 1.3.0</span></li><li><span>修改某些章節內容中的字句會使版本號變更為 1.2.4</span></li></ol></li></ul><p>&nbsp;</p><br><br><br><br><br><br><br><br><br></div></div>
</body>
</html>